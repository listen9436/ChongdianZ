function pre_process(){set_stage_skin(),prepare_elements(),get_main_maxXY(),max_lenX=mainBlock_box.maxX,max_lenY=mainBlock_box.maxY,refresh_main_blocks(0,0),get_sub_maxXY(),max_lenX=subBlock_box.maxX,max_lenY=subBlock_box.maxY,refresh_sub_blocks(0,0),max_lenX=mainBlock_box.maxX,max_lenY=mainBlock_box.maxY}function prepare_elements(){main_box.width=Laya.stage.width,main_box.height=Laya.stage.height,mainBlock_box.width=subBlock_box.width=Laya.stage.width,mainBlock_box.height=subBlock_box.height=Laya.stage.height-padding.topStart,mainBlock_box.scrollRect=subBlock_box.scrollRect=new Laya.Rectangle(0,0,mainBlock_box.width,mainBlock_box.height),Laya.stage.addChild(main_box),main_box.addChild(mainBlock_box),mainBlock_box.pos(0,padding.topStart),main_box.addChild(subBlock_box),subBlock_box.pos(0,padding.topStart),subBlock_box.visible=!1,mainBlock_box.currX=mainBlock_box.currY=subBlock_box.currX=subBlock_box.currY=0,main_box.addChild(input_block),input_block.zOrder=MAX_ZORDER,input_block.visible=!1,input_block.on("blur",input_block,input_over),input_block.on("enter",input_block,input_enter),input_block.on("input",input_block,input_change),mainBlock_box.on("click",mainBlock_box,block_box_hited),subBlock_box.on("click",subBlock_box,block_box_hited);var e=new Laya.Sprite;e.loadImage("psv/logo.png"),main_box.addChild(e),e.pos(46,34),fileButton=new Laya.Button("psv/labels.png","文件"),fileButton.labelColors="#9eb7c3,#9eb7c3,#ffffff,#ffffff",fileButton.labelFont="微软雅黑",fileButton.labelSize=14,fileButton.stateNum=1,fileButton.labelPadding="5,0,12,0",main_box.addChild(fileButton),fileButton.pos(252,34),fileButton.on("click",fileButton,deal_file),box_labelCtrl.setLabelImg("psv/labeln.png","psv/labels.png",126,38),box_labelCtrl.addLabelItem("主程序"),box_labelCtrl.addLabelItem("子函数"),main_box.addChild(box_labelCtrl),box_labelCtrl.pos(394,34),box_labelCtrl.currLabel=0,box_labelCtrl.on("labelclick",box_labelCtrl,change_label),skinButton=new Laya.Button("psv/labels.png","皮肤"),main_box.addChild(skinButton),skinButton.labelColors="#9eb7c3,#9eb7c3,#ffffff,#ffffff",skinButton.labelFont="微软雅黑",skinButton.labelSize=14,skinButton.stateNum=1,skinButton.labelPadding="5,0,12,0",skinButton.pos(860,34),skinButton.on("click",skinButton,change_skin),e=new Laya.Sprite,e.loadImage("psv/line1.png"),main_box.addChild(e),e.pos(0,84),main_box.addChild(menu_box),menu_box.pos(76,100),menu_box.width=menu_box.height=2;for(var t=["psv/eNewSub.png","psv/eCopy.png","psv/ePaste.png","psv/eDelete.png","psv/eInsert.png","psv/eGroup.png"],n=0;n<t.length;n++)e=new Laya.Button(t[n],null),menu_box.addChild(e),e.pos((22+e.width)*n,0),e.stateNum=3,e.disabled=!0;menu_box.getChildAt(0).visible=!1,menu_box.on("click",menu_box,edit_menu_click),e=new Laya.Sprite,e.loadImage("psv/line2.png"),main_box.addChild(e),e.pos(0,176),Laya.stage.addChild(file_menu),file_menu.visible=!1,file_menu.zOrder=MAX_ZORDER,file_menu.menuBgPic="psv/fBorder.png",file_menu.menuBgColor=null,file_menu.menuFgColor=null,file_menu.borderColor=null,file_menu.autoLayout=!1,file_menu.padding=[16,0,16,0,6],file_menu.setItemsRect(232,78,154,228),t=["psv/fNew.png","psv/fOpen.png","psv/fSave.png","psv/fBuild.png","psv/fSimu.png","psv/fDownload.png","psv/fSimuSetup.png"];for(var n=0;n<t.length;n++)e=new Laya.Button(t[n],null),e.stateNum=3,file_menu.addMenuItem(e);file_menu.on("menuclick",file_menu,file_menu_click),Laya.stage.addChild(insert_menu),insert_menu.visible=!1,insert_menu.zOrder=MAX_ZORDER,insert_menu.menuBgPic="psv/iBoarder.png",insert_menu.menuBgColor=null,insert_menu.menuFgColor=null,insert_menu.borderColor=null,insert_menu.autoLayout=!1,insert_menu.padding=[8,0,16,11,5],insert_menu.setItemsRect(610,165,339,631),t=["psv/iBlock.png","psv/iLine.png","psv/iIfelse.png","psv/iForin.png","psv/iWhiledo.png","psv/iBreak.png","psv/iContinue.png","psv/iReturn.png"];for(var n=0;n<t.length;n++)e=new Laya.Button(t[n],null),e.stateNum=3,e.disabled=!0,insert_menu.addMenuItem(e);insert_menu.on("menuclick",insert_menu,insert_menu_click),make_popmenu(pop_var_type,["数字","列表"]),pop_var_type.on("menuclick",pop_var_type,var_type_change),make_popmenu(pop_logical,[" 且 "," 或 "]),pop_logical.on("menuclick",pop_logical,logical_change),make_popmenu(pop_ifstate,[" 否则 ","   否则如果   "]),pop_ifstate.on("menuclick",pop_ifstate,ifstate_change),Laya.stage.addChild(group_menu),group_menu.visible=!1,group_menu.zOrder=MAX_ZORDER,group_menu.menuBgPic="psv/gBoarder.png",group_menu.menuBgColor=null,group_menu.menuFgColor=null,group_menu.borderColor=null,group_menu.autoLayout=!1,group_menu.padding=[12,6,16,10,10],group_menu.setItemsRect(0,0,164,100),t=["psv/gIn.png","psv/gOut.png"];for(var n=0;n<t.length;n++)e=new Laya.Button(t[n],null),e.stateNum=3,e.disabled=!0,group_menu.addMenuItem(e);group_menu.on("menuclick",group_menu,group_menu_click),ani_box=new Laya.Sprite,ani_box.width=Laya.stage.width,ani_box.height=Laya.stage.Height,ani_box.visible=!1,ani_box.zOrder=MAX_ZORDER,Laya.stage.addChild(ani_box),ani_block=new Block,ani_block.init("请选择","unSelect"),ani_block.selected=!0,ani_box.addChild(ani_block)}function group_menu_click(){var e=this.menuIndex;return-1==e?(clear_selected_block(),void disable_all_menu()):void 0}function make_popmenu(e,t){Laya.stage.addChild(e),e.visible=!1,e.zOrder=MAX_ZORDER,e.menuBgColor="#061e37",e.menuFgColor="#214261",e.borderColor="#10adfe",e.setItemsRect(0,0,padding.pop1Width,padding.pop1Height);for(var n=0;n<t.length;n++)foo=new Laya.Button(null,t[n]),foo.labelFont="微软雅黑",foo.labelColors="#ffffff,#ffffff,#ffffff,#ffffff",foo.labelSize=18,e.addMenuItem(foo)}function ifstate_change(){var e=this.menuIndex;if(-1==e)return clear_selected_block(),void disable_all_menu();var t,n,i;if(" 结束 "==selectedBlock.text){t=selectedBlock.indexID.slice(),n=get_entry_array(t),0==e?(n.subs.push([{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}]),i=padding.ifthenAdjust):(n.subs.push({block:"line",subs:[{type:"unSelect",name:"newBlock"}]},[{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}]),i=padding.ifelseAdjust+padding.line2Frame);var l=selectedBlock.localToGlobal({x:0,y:selectedBlock.height}).y,a=get_curr_box();l+i>a.localToGlobal({x:0,y:a.height}).y&&(a.currY-=l+i-a.localToGlobal({x:0,y:a.height}).y)}else{var o=[" 否则 ","   否则如果   "];if(selectedBlock.text!=o[e]){t=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),n=get_entry_array(t);var r=selectedBlock.indexID[selectedBlock.indexID.length-1];if(0==e)n.splice(r,1),n.splice(r+1);else{n.splice(r,0,{block:"line",subs:[{type:"unSelect",name:"newBlock"}]});var l=selectedBlock.localToGlobal({x:0,y:selectedBlock.height}).y,a=get_curr_box();l+padding.ifconAdjust>a.localToGlobal({x:0,y:a.height}).y&&(a.currY-=l+padding.ifconAdjust-a.localToGlobal({x:0,y:a.height}).y)}}}clear_selected_block(),disable_all_menu(),refresh_curr_page()}function logical_change(){var e=this.menuIndex;if(-1==e)return clear_selected_block(),void disable_all_menu();var t=["and","or"],n=selectedBlock.indexID.slice();if("▼"==selectedBlock.text){var i=get_entry_array(n);i.subs.push({type:"logical",name:t[e]},{type:"unSelect",name:"newBlock"})}else{n=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1);var i=get_entry_array(n),l=selectedBlock.indexID[selectedBlock.indexID.length-1];selectedBlock.text!=this.getChildAt(e).label&&i.splice(l,1,{type:"logical",name:t[e]})}clear_selected_block(),disable_all_menu(),refresh_curr_page()}function var_type_change(){var e=this.menuIndex;if(-1==e)return clear_selected_block(),void disable_all_menu();var t=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),n=get_entry_array(t);selectedBlock.indexID[selectedBlock.indexID.length-2],selectedBlock.text!=this.getChildAt(e).label&&(0==e?(n.type="number",n.value="0"):(n.type="array",n.value=[{type:"number",value:"0"}])),clear_selected_block(),disable_all_menu(),refresh_curr_page()}function get_entry_array(e){for(var t=jsonObj,n=0;n<e.length;n++)t=t[e[n]];return t}function get_curr_box(){return 0==mainBlock_box.visible?subBlock_box:mainBlock_box}function get_sameID_block(e,t){for(var n,i=0;i<e.numChildren;i++){var l=e.getChildAt(i);if(l.numChildren>0&&(n=get_sameID_block(l,t),null!=n))return n;if("Block"==l.__pollClass){if(l.indexID.length!=t.length)continue;for(var a=0,o=t.length;o>a&&l.indexID[a]==t[a];a++);if(a==o)return l}}return null}function block_insert_ani(){entry_strArray=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),entry=get_entry_array(entry_strArray),position=selectedBlock.indexID[selectedBlock.indexID.length-1];var e=get_curr_box(),t={subs:[entry.slice(position,position+1)]};"subFunc"==selectedBlock.indexID[0]&&(t.__subid=selectedBlock.indexID[1]);var n=mparse_line(["subs"],0,null,t),i=selectedBlock.localToGlobal({x:0,y:0}),l=i.x+n+padding.blockInter;l+ani_block.width>e.localToGlobal({x:e.width,y:0}).x&&(l=e.localToGlobal({x:e.width,y:0}).x-ani_block.width),ani_block.pos(l,-padding.blockHeight),ani_box.visible=!0;var a=Laya.stage.height/500,o=i.y/a<250?250:i.y/a;Laya.Tween.to(ani_block,{y:i.y},o,null,Laya.Handler.create(this,ani_over))}function ani_over(){var e,t,n,i={type:"unSelect",name:"newBlock"},l=selectedBlock.indexID.slice();if(ani_box.visible=!1,selectedBlock.indexID.length>2&&"args"==selectedBlock.indexID[selectedBlock.indexID.length-2]){e=selectedBlock.indexID.slice();var a=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),o=get_entry_array(a)[e[e.length-1]],r=[o,i];e=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),t=get_entry_array(e),n=selectedBlock.indexID[selectedBlock.indexID.length-1],t.splice(n,1,r),l.push(1)}else e=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),t=get_entry_array(e),n=selectedBlock.indexID[selectedBlock.indexID.length-1],t.splice(n+1,0,i),l[l.length-1]=l[l.length-1]+1;var s={subs:[t.slice(n,n+1)]};"subFunc"==selectedBlock.indexID[0]&&(s.__subid=selectedBlock.indexID[1]);var d=mparse_line(["subs"],0,null,s);d+=get_txt_width("请选择")+2*padding.blockInter;var c=selectedBlock.localToGlobal({x:0,y:0}).x,u=get_curr_box();c+d>u.localToGlobal({x:u.width,y:0}).x&&(u.currX+=c+d-u.localToGlobal({x:u.width,y:0}).x),selectedBlock.selected=!1,selectedBlock=null,disable_all_menu(),refresh_curr_page();var p=get_sameID_block(u,l);p.selected=!0,selectedBlock=p;var _=getPrefix(selectedBlock),h=getMenuItem(_);popup_SCM(h)}function insert_menu_click(){function e(e,t){var n,i,l=get_curr_box();if(n=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),i=get_entry_array(n),position=selectedBlock.indexID[selectedBlock.indexID.length-1],"LineBlock"==selectedBlock.__pollClass){if("cif"==selectedBlock.parent.type)return;"condition"==selectedBlock.type?(n=selectedBlock.indexID.slice(),n[n.length-1]=1,i=get_entry_array(n),i.splice(0,0,e)):i.splice(position+1,0,e),selectedBlock.height+selectedBlock.localToGlobal({x:0,y:0}).y+padding.lineInter>=l.localToGlobal({x:0,y:0}).y+l.height&&(l.currY-=selectedBlock.height-(l.localToGlobal({x:0,y:0}).y+l.height-selectedBlock.localToGlobal({x:0,y:0}).y)+t+padding.lineInter)}else if("FrameBlock"==selectedBlock.__pollClass&&("funcFrame"==selectedBlock.type?(n=selectedBlock.indexID.slice(),i=get_entry_array(n),i.splice(0,0,e)):"cif"==selectedBlock.type?(n=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-3),position=selectedBlock.indexID[selectedBlock.indexID.length-3],i=get_entry_array(n),i.splice(position+1,0,e)):i.splice(position+1,0,e),"funcFrame"!=selectedBlock.type)){var a,o=selectedBlock.type;"cif"==o?(n=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),a=mdeal_ifelse(n,0,1)):(n=selectedBlock.indexID.slice().concat(["subs"]),a=mdeal_loop(o,n,0,1)),a.height+selectedBlock.localToGlobal({x:0,y:0}).y>=l.localToGlobal({x:0,y:0}).y+l.height&&(l.currY-=a.height-(l.localToGlobal({x:0,y:0}).y+l.height-selectedBlock.localToGlobal({x:0,y:0}).y)+t)}selectedBlock.selected=!1,selectedBlock=null,disable_all_menu(),refresh_curr_page()}var t=this.menuIndex;if(-1==t)return clear_selected_block(),void disable_all_menu();var n=["iblock","iline","iifelse","iforin","iwhiledo","ibreak","icontinue","ireturn"],i={iblock:function(){var e,t;if("Block"==selectedBlock.__pollClass)auto_insert=!0,block_insert_ani();else{if("LineBlock"!=selectedBlock.__pollClass)return;e=selectedBlock.indexID.slice(),t=get_entry_array(e),t.subs.splice(0,0,{type:"unSelect",name:"newBlock"});var n=get_curr_box();disable_all_menu(),n.currX>0&&(n.currX=0),refresh_curr_page()}},iline:function(){e({block:"line",subs:[{type:"unSelect",name:"newBlock"}]},padding.lineHeight+padding.lineInter)},iifelse:function(){e({block:"ifelse",subs:[{block:"line",subs:[{type:"unSelect",name:"newBlock"}]},[{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}]]},padding.ifelseAdjust)},iforin:function(){e({block:"forin",subs:[{block:"line",subs:[{type:"unSelect",name:"newBlock"},{type:"unSelect",name:"newBlock"}]},[{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}]]},padding.loopAdjust)},iwhiledo:function(){e({block:"whiledo",subs:[{block:"line",subs:[{type:"unSelect",name:"newBlock"}]},[{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}]]},padding.loopAdjust)},ibreak:function(){e({block:"line",subs:[{type:"ctrlState",name:"breaks"}]},padding.lineHeight+padding.lineInter)},icontinue:function(){e({block:"line",subs:[{type:"ctrlState",name:"continues"}]},padding.lineHeight+padding.lineInter)},ireturn:function(){e({block:"line",subs:[{type:"ctrlState",name:"returns"}]},padding.lineHeight+padding.lineInter)}};i[n[t]]()}function edit_menu_click(e){for(var t=e.target,n=0;n<this.numChildren&&t!==this.getChildAt(n);n++);var i=["enew","ecopy","epaste","edelete","einsert","egroup"],l={enew:function(){var e;e=0==jsonObj.subFunc.length?0:jsonObj.subFunc[jsonObj.subFunc.length-1].id+1;var t="子函数"+(e+1)+"号";jsonObj.subFunc.push({name:t,type:"subfunc",id:e,parameter:[],localVar:[],funcblock:[{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}]}),clear_selected_block(),subBlock_box.currY=-9999,refresh_curr_page()},ecopy:function(){},epaste:function(){},edelete:function(){var e,t,n;if(e=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),t=get_entry_array(e),n=selectedBlock.indexID[selectedBlock.indexID.length-1],"Block"==selectedBlock.__pollClass){if("logical"==selectedBlock.type){for(var i=0,l=n+1;l<t.length&&"logical"!=t[l].type;l++)i++;if(0==i)return;return t.splice(n,i+1),clear_selected_block(),disable_all_menu(),void refresh_curr_page()}if("ifState"==selectedBlock.type)return isArray(t[n])?t.splice(n,1):t.splice(n,2),clear_selected_block(),disable_all_menu(),void refresh_curr_page();if(-1!=selectedBlock.type.search(/Input$/))e=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-2),t=get_entry_array(e),n=selectedBlock.indexID[selectedBlock.indexID.length-2],"numInput"==selectedBlock.type?isArray(t.value)?t.value.length>1?t.value.splice(selectedBlock.indexID[selectedBlock.indexID.length-1],1):t.value=[{type:"number",value:"0"}]:t.value=0:t.splice(n,1);else{var a=!1;"args"==selectedBlock.indexID[selectedBlock.indexID.length-3]||"arrayIndex"==selectedBlock.indexID[selectedBlock.indexID.length-2]?1==t.length&&(a=!0):"args"==selectedBlock.indexID[selectedBlock.indexID.length-2]?a=!0:("forin"==selectedBlock.parent.parent.type&&"condition"==selectedBlock.parent.type&&(a=!0),1==t.length&&(a=!0)),a?t.splice(n,1,{type:"unSelect",name:"newBlock"}):t.splice(n,1)}}else"LineBlock"==selectedBlock.__pollClass?"condition"==selectedBlock.type?"forin"==selectedBlock.parent.type?t.splice(n,1,{block:"line",subs:[{type:"unSelect",name:"newBlock"},{type:"unSelect",name:"newBlock"}]}):t.splice(n,1,{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}):1==t.length?t.splice(n,1,{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}):t.splice(n,1):"FrameBlock"==selectedBlock.__pollClass&&("forin"==selectedBlock.type||"whiledo"==selectedBlock.type?1==t.length?t.splice(n,1,{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}):t.splice(n,1):"parameter"==selectedBlock.type||"localVar"==selectedBlock.type?(t=get_entry_array(selectedBlock.indexID),t.splice(0,t.length)):"globalVar"==selectedBlock.type?(t=get_entry_array(selectedBlock.indexID),t.splice(0,t.length,{name:"LED元组",type:"tuple",value:[{type:"periObj",name:"led1"},{type:"periObj",name:"led2"},{type:"periObj",name:"led3"},{type:"periObj",name:"led4"}],id:0})):"funcFrame"==selectedBlock.type?(t=get_entry_array(selectedBlock.indexID),t.splice(0,t.length,{block:"line",subs:[{type:"unSelect",name:"newBlock"}]})):"cif"==selectedBlock.type?0==selectedBlock.indexID[selectedBlock.indexID.length-1]?(n=selectedBlock.indexID[selectedBlock.indexID.length-3],t=get_entry_array(selectedBlock.indexID.slice(0,selectedBlock.indexID.length-3)),1==t.length?t.splice(n,1,{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}):t.splice(n,1)):t.splice(n,2):"cthen"==selectedBlock.type&&t.splice(n,1,[{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}]));selectedBlock.selected=!1,selectedBlock=null,disable_all_menu(),refresh_curr_page()},einsert:function(){var e=t.localToGlobal({x:0,y:t.height});insert_menu.setItemsRect(e.x+t.width/2-169.5,e.y+5,339,631),insert_menu.visible=!0},egroup:function(){var e=t.localToGlobal({x:0,y:t.height});group_menu.setItemsRect(e.x+t.width/2-82,e.y+5,164,100),group_menu.visible=!0}};l[i[n]]()}function change_label(){clear_selected_block(),disable_all_menu();var e=this.currLabel;1==e?(menu_box.getChildAt(0).visible=!0,menu_box.getChildAt(0).disabled=!1,max_lenX=subBlock_box.maxX,max_lenY=subBlock_box.maxY,currX=subBlock_box.currX,currY=subBlock_box.currY,clear_all_children(subBlock_box),refresh_sub_blocks(currX,currY),subBlock_box.visible=!0,mainBlock_box.visible=!1):(menu_box.getChildAt(0).visible=!1,max_lenX=mainBlock_box.maxX,max_lenY=mainBlock_box.maxY,currX=mainBlock_box.currX,currY=mainBlock_box.currY,clear_all_children(mainBlock_box),refresh_main_blocks(currX,currY),mainBlock_box.visible=!0,subBlock_box.visible=!1)}function file_menu_click(){var e=this.menuIndex;if(-1==e)return void $(".fileOpen:last").remove();var t=["fnew","fopen","fsave","fbuild","fsimu","fdownload","fsetup"],n={fnew:function(){jsonObj={project:{hardware:"PYV100"},simulation:{width:800,height:600},globalVar:[{name:"LED元组",type:"tuple",value:[{type:"periObj",name:"led1"},{type:"periObj",name:"led2"},{type:"periObj",name:"led3"},{type:"periObj",name:"led4"}],id:0}],main:[{block:"line",subs:[{type:"unSelect",name:"newBlock"}]}],subFunc:[]},fileName="新建工程文件.json",mainBlock_box.visible=!0,subBlock_box.visible=!1,get_main_maxXY(),max_lenX=mainBlock_box.maxX,max_lenY=mainBlock_box.maxY,clear_all_children(mainBlock_box),refresh_main_blocks(0,0),get_sub_maxXY(),max_lenX=subBlock_box.maxX,max_lenY=subBlock_box.maxY,clear_all_children(subBlock_box),refresh_sub_blocks(0,0),max_lenX=mainBlock_box.maxX,max_lenY=mainBlock_box.maxY,box_labelCtrl.currLabel=0,menu_box.getChildAt(0).visible=!1,disable_all_menu()},fopen:function(){},fsave:function(){function e(e,t,n){var i;if("function"==typeof window.Blob)i=new Blob([e],{type:t});else{var l=window.BlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder,a=new l;a.append(e),i=a.getBlob(t)}var o=window.URL||window.webkitURL,r=o.createObjectURL(i),s=document.createElement("a");if("download"in s){s.style.visibility="hidden",s.href=r,s.download=n,document.body.appendChild(s);var d=document.createEvent("MouseEvents");d.initEvent("click",!0,!0),s.dispatchEvent(d),document.body.removeChild(s)}else navigator.msSaveBlob?navigator.msSaveBlob(i,n):location.href=r}var t=JSON.stringify(jsonObj);e(t,"json/json*",fileName)},fbuild:function(){},fsimu:function(){},fdownload:function(){},fsetup:function(){}};n[t[e]]()}function deal_file(){var e;e=this.localToGlobal({x:0,y:this.height}),file_menu.setItemsRect(e.x-20,e.y+5,154,228),file_menu.visible=!0,$(".fileOpen:first").remove(),e=file_menu.getChildAt(1).localToGlobal({x:0,y:0}),$("body").append('<input type="file" accept=".json" class="fileOpen" style="filter:alpha(opacity=0);opacity:0;width: 150px;height:30px;background:#fff;margin-top:200px;margin-left:546px;outline:none;border:0 none;z-Index:999"; />'),$(".fileOpen").css({"margin-left":e.x+Laya.stage._canvasTransform.tx+"px","margin-top":e.y+Laya.stage._canvasTransform.ty-8+"px"}),$(".fileOpen:last").on("change",function(){var e=this.files[0],t=new FileReader;t.readAsText(e,"utf-8"),t.onload=function(){jsonObj=JSON.parse(this.result),fileName=e.name,mainBlock_box.visible=!0,subBlock_box.visible=!1,get_main_maxXY(),max_lenX=mainBlock_box.maxX,max_lenY=mainBlock_box.maxY,clear_all_children(mainBlock_box),refresh_main_blocks(0,0),get_sub_maxXY(),max_lenX=subBlock_box.maxX,max_lenY=subBlock_box.maxY,clear_all_children(subBlock_box),refresh_sub_blocks(0,0),max_lenX=mainBlock_box.maxX,max_lenY=mainBlock_box.maxY,box_labelCtrl.currLabel=0,menu_box.getChildAt(0).visible=!1,disable_all_menu(),$(".fileOpen:last").remove()}}),$(".fileOpen:last").on("click",function(){$(".fileOpen:last").toggle(),file_menu.visible=!1})}function has_popmenu(){for(var e=[file_menu,insert_menu,pop_var_type,pop_logical,pop_ifstate],t=0;t<e.length;t++)if(1==e[t].visible)return!0;return!1}function stage_on_keydown(e){if(!has_popmenu()){var t=0,n=!1,i=subBlock_box;mainBlock_box.visible&&(i=mainBlock_box);var l=i.currY,a=i.currX;if(38==e.keyCode||40==e.keyCode){t=3*scrollUnitY,40==e.keyCode&&(t=-t);var o=l+t;o>0?o=0:o+max_lenY<i.height&&(o=i.height-max_lenY),o!=l&&(l=o,i.currY=l,n=!0)}if(37==e.keyCode||39==e.keyCode){t=3*scrollUnitY,37==e.keyCode&&(t=3*-scrollUnitY);var r=a+t;0>r?r=0:r+i.width>max_lenX&&(r=max_lenX-i.width),r!=a&&(a=r,i.currX=a,n=!0)}n&&(clear_all_children(i),i===mainBlock_box?refresh_main_blocks(a,l):refresh_sub_blocks(a,l),clear_selected_block(),disable_all_menu())}}function stage_on_wheel(e){if(!has_popmenu()){var t=subBlock_box;mainBlock_box.visible&&(t=mainBlock_box);var n=t.currX,i=t.currY,l=e.delta*scrollUnitY,a=i+l;a>0?a=0:a+max_lenY<t.height&&(a=t.height-max_lenY),a!=i&&(i=a,t.currY=i,clear_all_children(t),t===mainBlock_box?refresh_main_blocks(n,i):refresh_sub_blocks(n,i),clear_selected_block(),disable_all_menu())}}function clear_all_children(e){for(var t,n=e.numChildren-1;n>=0;n--)t=e.getChildAt(n),0!=t.numChildren&&clear_all_children(t),t.graphics.clear(),t.removeSelf(),t.breset(),t.off("click",t,block_deal_hit),Laya.Pool.recover(t.__pollClass,t)}function show_variable_block(e,t,n,i){if(!(i>Laya.stage.height)){var l=get_entry_array(e),a=Laya.Pool.getItemByClass("FrameBlock",FrameBlock);a.indexID=e.slice();var o,r=padding.varFrameHead;a.type=t;var s="globalVar"==e[0]?mainBlock_box:subBlock_box;s.addChild(a),a.pos(padding.frameR-n,i);var d=Laya.Pool.getItemByClass("Block",Block),c="parameter"==t?"  类型        名称":"  类型        名称            初始值";d.init(c,"plainTxt"),a.addChild(d),d.pos(padding.varTypeL,r),r+=d.height;var u=e.slice();u.push(0);for(var p=0;p<l.length;p++)o=Laya.Pool.getItemByClass("LineBlock",LineBlock),o.type="plain",a.addChild(o),o.pos(padding.lineLR,r),o.lwidth=max_lenX-(o.localToGlobal({x:0,y:0}).x+n)-padding.lineLR-padding.frameR,u[u.length-1]=p,r+=add_var_line(u,r,o,t);d=Laya.Pool.getItemByClass("ButtonBlock",ButtonBlock),d.init("varAdd"),d.indexID=e.slice(),a.addChild(d),d.pos(padding.blockLR,r+padding.lineInter),r+=d.height+padding.lineInter+padding.line2Frame;var _=max_lenX-(a.localToGlobal({x:0,y:0}).x+n)-padding.frameR;return a.setFrameSize(_,r-padding.varFrameHead),r+padding.frame2Frame}}function add_var_line(e,t,n,i){var l=get_entry_array(e),a=padding.blockLR,o=l.type,r="varType";"tuple"==o&&(r="noSelect");var s=type2prop[i][o][0],d=Laya.Pool.getItemByClass("Block",Block);d.init(s,r),n.addChild(d),d.pos(a,(n.height-d.height)/2),d.indexID=e.slice(),d.indexID.push("type"),a+=padding.lineLR+d.width;var r=i+"Input";if("tuple"==o&&(r="noSelect"),d=Laya.Pool.getItemByClass("Block",Block),d.init(l.name,r),n.addChild(d),d.pos(a,(n.height-d.height)/2),d.indexID=e.slice(),d.indexID.push("name"),a+=padding.lineLR+d.width,"parameter"==i)return n.height;if(r="numInput","tuple"==o&&(r="noSelect"),isArray(l.value)){for(var c=0;c<l.value.length;c++)d=Laya.Pool.getItemByClass("Block",Block),s="tuple"==o?type2prop[l.value[c].type][l.value[c].name][0]:l.value[c].value,d.init(s,r),n.addChild(d),d.pos(a,(n.height-d.height)/2),d.indexID=e.concat(["value",c]),a+=padding.lineLR+d.width;if("tuple"==o)return n.height;d=Laya.Pool.getItemByClass("ButtonBlock",ButtonBlock),d.init("arrayAdd"),n.addChild(d),d.pos(a,(n.height-d.height)/2),d.indexID=e.slice(),d.indexID.push("value")}else d=Laya.Pool.getItemByClass("Block",Block),d.init(l.value,r),n.addChild(d),d.pos(a,(n.height-d.height)/2),d.indexID=e.concat(["value",0]),a+=padding.lineLR+d.width;return n.height}function get_main_maxXY(){var e,t=curr_Y=0;mainBlock_box.heightArray=[],e=get_varblock_xy(["globalVar"]),e.width>t&&(t=e.width),mainBlock_box.heightArray.push(e.height),curr_Y+=e.height,e=get_funcblock_xy(["main"]),e.width>t&&(t=e.width),mainBlock_box.heightArray.push(e.height),curr_Y+=e.height,mainBlock_box.maxX=t>mainBlock_box.width?t:mainBlock_box.width,mainBlock_box.maxY=curr_Y>mainBlock_box.height?curr_Y:mainBlock_box.height}function get_sub_maxXY(){var e,t=curr_Y=0;subBlock_box.heightArray=[];for(var n=["subFunc"],i=0;i<jsonObj.subFunc.length;i++)curr_Y+=padding.blockHeight+padding.line2Frame,e=get_varblock_xy(n.concat([i,"parameter"])),e.width>t&&(t=e.width),subBlock_box.heightArray.push(e.height),curr_Y+=e.height,e=get_varblock_xy(n.concat([i,"localVar"])),e.width>t&&(t=e.width),subBlock_box.heightArray.push(e.height),curr_Y+=e.height,e=get_funcblock_xy(n.concat([i,"funcblock"])),e.width>t&&(t=e.width),subBlock_box.heightArray.push(e.height),curr_Y+=e.height;subBlock_box.maxX=t>subBlock_box.width?t:subBlock_box.width,subBlock_box.maxY=curr_Y>subBlock_box.height?curr_Y:subBlock_box.height}function get_varblock_xy(e){for(var t=get_entry_array(e),n=padding.varFrameHead+padding.blockHeight,i=(padding.frameR+padding.lineLR,0),l=0;l<t.length;l++){if(n+=padding.lineHeight,tmp_X=padding.lineLR,tmp_X+=2*padding.blockLR+get_txt_width("数字"),tmp_X+=get_txt_width(t[l].name)+padding.blockLR,t[l].hasOwnProperty("value")){if(isArray(t[l].value)){if("array"==t[l].type){for(var a=0;a<t[l].value.length;a++)tmp_X+=get_txt_width(t[l].value[a].value)+padding.blockLR;tmp_X+=padding.addButtonWidth+padding.blockLR}}else tmp_X+=get_txt_width(t[l].value);tmp_X+=padding.blockLR}tmp_X+=padding.frameR,tmp_X>i&&(i=tmp_X)}return n+=padding.blockHeight+padding.lineInter+2*padding.line2Frame,{width:i,height:n}}function get_funcblock_xy(e){var t=get_entry_array(e),n=!1;max_width=0;for(var i,l=0,a=padding.line2Frame,o=0;o<t.length;o++)if("line"==t[o].block)l=mparse_line(e.concat([o],["subs"]),padding.blockLR,null)+padding.blockLR+2*padding.lineLR+2*padding.frameR,l>max_width&&(max_width=l),a+=padding.lineHeight+padding.lineInter,n=!0;else{n&&(a+=padding.line2Frame-padding.lineInter);var r=t[o].block;i="ifelse"==r?mdeal_ifelse(e.concat([o,"subs"]),padding.mIfelseIndent,1):mdeal_loop(r,e.concat([o,"subs"]),padding.mLoopIndent,1),n=!1,a+=i.height,l=i.width+2*padding.frameR,l>max_width&&(max_width=l)}return n&&(a+=padding.lineInter),{width:max_width,height:a+padding.varFrameHead+padding.frame2Frame}}function mdeal_ifelse(e,t,n){for(var i=get_entry_array(e),l=i.length,a=0,o=frame_block=0,r=0;l>r;r+=2){if(r==l-1){a+=padding.blockHeight+padding.frame2Frame,frame_block=mdeal_then_state(e.concat([r]),t,n),o=frame_block.width,a+=frame_block.height,o>max_width&&(max_width=o);break}frame_block=mdeal_if_state(e.concat([r]),t,n),o=frame_block.width,a+=frame_block.height,o>max_width&&(max_width=o),frame_block=mdeal_then_state(e.concat([r+1]),t,n),o=frame_block.width,a+=frame_block.height,o>max_width&&(max_width=o),l-(r+2)>=2&&(a+=padding.blockHeight+padding.frame2Frame)}return a+=padding.blockHeight+padding.frame2Frame,{width:max_width,height:a}}function mdeal_if_state(e,t,n){var i;return get_entry_array(e),padding.line2Frame,i=mparse_line(e.concat(["subs"]),padding.blockLR,null)+t+padding.frameR*n+padding.blockLR+2*padding.lineLR,i+=get_txt_width("▼")+padding.blockInter,{width:i,height:padding.lineHeight+2*padding.line2Frame+padding.frame2Frame}}function mdeal_then_state(e,t,n){for(var i=get_entry_array(e),l=padding.frame2Frame,a=frame_block=0,o=!1,r=0;r<i.length;r++){var s=i[r].block;"line"==s?(a=mparse_line(e.concat([r,"subs"]),padding.blockLR,null)+t+padding.frameR*n+padding.blockLR+2*padding.lineLR,a>max_width&&(max_width=a),l+=padding.lineHeight+padding.lineInter,o=!0):(o&&(l+=padding.frame2Frame-padding.lineInter),"ifelse"==s?frame_block=mdeal_ifelse(e.concat([r],["subs"]),t+padding.mIfelseIndent,n+1):frame_block=mdeal_loop(s,e.concat([r],["subs"]),t+padding.mLoopIndent,n+1),l+=frame_block.height,a=frame_block.width,a>max_width&&(max_width=a),o=!1)}return o&&(l+=padding.line2Frame-padding.lineInter),{width:max_width,height:l+padding.frame2Frame}}function mdeal_loop(e,t,n,i){var l=get_entry_array(t),a=padding.line2Frame,o=frame_block=0,r=!1,s="forin"==e?["",""," 遍历条件：当变量 ",""," 存在于数组 ",""]:["",""," 循环成立条件：",""];o=mparse_line(t.concat([0,"subs"]),padding.blockLR,s)+n+padding.frameR*i+padding.blockLR+2*padding.lineLR,"whiledo"==e&&(o+=get_txt_width("▼")+padding.blockInter),o>max_width&&(max_width=o),a+=padding.lineHeight+padding.lineInter;for(var r=!0,d=0;d<l[1].length;d++){var c=l[1][d].block;"line"==c?(o=mparse_line(t.concat([1,d,"subs"]),padding.blockLR,null),o+=n+padding.frameR*i+padding.blockLR+2*padding.lineLR,o>max_width&&(max_width=o),a+=padding.lineHeight+padding.line2Frame-padding.lineInter,r=!0):(r&&(a+=padding.frame2Frame-padding.lineInter),"ifelse"==c?frame_block=mdeal_ifelse(t.concat([1,d,"subs"]),n+padding.mIfelseIndent,i+1):frame_block=mdeal_loop(c,t.concat([1,d,"subs"]),n+padding.mLoopIndent,i+1),a+=frame_block.height,o=frame_block.width,o>max_width&&(max_width=o),r=!1)}return r&&(a+=padding.line2Frame-padding.lineInter),{width:max_width,height:a+padding.frame2Frame}}function mget_entry_array(e,t){for(var n=t,i=0;i<e.length;i++)n=n[e[i]];return n}function mparse_line(e,t,n,i){if(3==arguments.length)var i=jsonObj;var l,a,o,r,s=t,d=null,c=mget_entry_array(e,i);"subFunc"==e[0]&&(d=e[1]),i.hasOwnProperty("__subid")&&(d=i.__subid);for(var u=0;u<c.length;u++)null!=n&&u<(n.length-2)/2&&""!=n[2*(u+1)]&&(a=n[2*(u+1)],s+=get_txt_width(a)-padding.blockInter),isArray(c[u])?s=mparse_line(e.concat([u]),s,null,i)+padding.blockInter:(l=c[u].type,c[u].hasOwnProperty("name")?o=type2prop[l][c[u].name][0]:c[u].hasOwnProperty("value")?o=c[u].value:c[u].hasOwnProperty("id")&&(o=getBlockIdTxt(l,c[u].id,d)),"__errorID"==o&&(o=" 无此元素 "),s+=get_txt_width(o)+padding.blockInter,c[u].hasOwnProperty("args")&&(s+=get_txt_width("（")-padding.blockInter,r=null,"subFunc"!=l&&(r=type2prop[l][c[u].name]),s=mparse_line(e.concat([u,"args"]),s,r,i),s+=get_txt_width("）")),c[u].hasOwnProperty("arrayIndex")&&(s+=get_txt_width(" [")-padding.blockInter,s=mparse_line(e.concat([u,"arrayIndex"]),s,null,i),s+=get_txt_width(" ] ")));return s-padding.blockInter}function get_txt_width(e){return Laya.Browser.context.font="16px 微软雅黑",Math.ceil(Laya.Browser.context.measureText(e).width)+2*padding.blockRadius}function show_func_name(e,t,n,i){var l=Laya.Pool.getItemByClass("Block",Block);l.init("函数名称：","plainTxt"),l.color="rgb(51,255,255)",subBlock_box.addChild(l),l.pos(padding.funcNameL-t,n);var a=padding.funcNameL+l.width;return l=Laya.Pool.getItemByClass("Block",Block),l.init(e,"strInput"),l.color="rgb(51,255,255)",subBlock_box.addChild(l),l.pos(a-t,n),l.indexID=["subFunc",i,"name"],padding.blockHeight+padding.line2Frame}function refresh_sub_blocks(e,t){if(jsonObj.hasOwnProperty("subFunc")){for(var n=["subFunc"],i=jsonObj.subFunc,l=0;l<i.length;l++)t+=show_func_name(i[l].name,e,t,l),t+=t+subBlock_box.heightArray[3*l]<0?subBlock_box.heightArray[3*l]:show_variable_block(n.concat([l,"parameter"]),"parameter",e,t),t+=t+subBlock_box.heightArray[3*l+1]<0?subBlock_box.heightArray[3*l+1]:show_variable_block(n.concat([l,"localVar"]),"localVar",e,t),t+=t+subBlock_box.heightArray[3*l+2]<0?subBlock_box.heightArray[3*l+2]:show_func_block(n.concat([l,"funcblock"]),e,t);
blocks_add_onclick(subBlock_box)}}function refresh_main_blocks(e,t){t+=show_variable_block(["globalVar"],"globalVar",e,t),t+=show_func_block(["main"],e,t),blocks_add_onclick(mainBlock_box)}function show_func_block(e,t,n){if(!(n>Laya.stage.height)){var i,l=get_entry_array(e),a=!1,o="main"==e[0]?mainBlock_box:subBlock_box,r=Laya.Pool.getItemByClass("FrameBlock",FrameBlock);o.addChild(r),r.pos(padding.frameR-t,n),r.indexID=e.slice(),r.type="funcFrame";for(var s=padding.varFrameHead+padding.line2Frame,d=0;d<l.length;d++)if(i=Laya.Pool.getItemByClass("LineBlock",LineBlock),i.type="normal",i.indexID=e.concat([d]),"line"==l[d].block)r.addChild(i),i.pos(padding.lineLR,s),parse_line(e.concat([d,"subs"]),padding.blockLR,i,null),i.lwidth=max_lenX-(i.localToGlobal({x:0,y:0}).x+t)-padding.lineLR-padding.frameR,s+=i.height+padding.lineInter,a=!0;else{var c=l[d].block;a&&(s+=padding.line2Frame-padding.lineInter),s="ifelse"==c?deal_ifelse(e.concat([d,"subs"]),t,s,r,1):deal_loop(c,e.concat([d,"subs"]),t,s,r,1),a=!1}return a&&(s+=padding.lineInter),r.setFrameSize(max_lenX-2*padding.frameR,s-padding.varFrameHead),s+padding.frame2Frame}}function blocks_add_onclick(e){for(var t,n,i=e.numChildren-1;i>=0;i--)t=e.getChildAt(i),0!=t.numChildren&&blocks_add_onclick(t),t.hasOwnProperty("__pollClass")&&(n=t.__pollClass,"Block"==n&&"plainTxt"==t.type||"Block"!=n&&"LineBlock"!=n&&"FrameBlock"!=n||t.on("click",t,block_deal_hit))}function deal_loop(e,t,n,i,l,a){var o=padding.line2Frame,r=get_entry_array(t),s=Laya.Pool.getItemByClass("FrameBlock",FrameBlock),d=Laya.Pool.getItemByClass("LineBlock",LineBlock),c="forin"==e?["",""," 遍历条件：当变量 ",dConst.forin1st," 存在于数组 ",dConst.forin2nd]:["",""," 循环成立条件：",dConst.beginningOL];s.type=e,l.addChild(s);var u=a>1?padding.loopIndent+padding.conFramGap:padding.loopIndent;s.pos(u,i),s.indexID=t.slice(0,t.length-1),d.indexID=t.concat([0]),d.type="condition",s.addChild(d),d.pos(padding.lineLoopIndent,o),parse_line(t.concat([0,"subs"]),padding.blockLR,d,c),d.lwidth=max_lenX-(d.localToGlobal({x:0,y:0}).x+n)-padding.frameR*a-padding.lineLR-padding.frameR,o+=d.height+padding.lineInter;for(var p=!0,_=0;_<r[1].length;_++){var h=r[1][_].block;"line"==h?(d=Laya.Pool.getItemByClass("LineBlock",LineBlock),d.indexID=t.concat([1,_]),d.type="normal",s.addChild(d),d.pos(padding.lineLoopIndent,o),parse_line(t.concat(1,_,"subs"),padding.blockLR,d,null),d.lwidth=max_lenX-(d.localToGlobal({x:0,y:0}).x+n)-padding.frameR*a-padding.lineLR-padding.frameR,o+=d.height+padding.lineInter,p=!0):(p&&(o+=padding.frame2Frame-padding.lineInter),o="ifelse"==h?deal_ifelse(t.concat([1,_,"subs"]),n,o,s,a+1):deal_loop(h,t.concat([1,_,"subs"]),n,o,s,a+1),p=!1)}p&&(o+=padding.line2Frame-padding.lineInter);var b=max_lenX-(s.localToGlobal({x:0,y:0}).x+n)-padding.conFramGap-padding.frameR*a-padding.frameR;return s.setFrameSize(b,o),i+s._fheight+padding.frame2Frame}function deal_ifelse(e,t,n,i,l){var a,o=get_entry_array(e),r=o.length,s=Laya.Pool.getItemByClass("ConnectBlock",ConnectBlock);i.addChild(s);for(var d=0;r>d;d+=2){if(d==r-1){n=output_con(" 否则 ",n,i,l,e.concat([d])),a=i.getChildAt(i.numChildren-1),s.addPoint(a.x,a.y+a.height/2),n=deal_then_state(e.concat([d]),t,n,i,l);break}n=deal_if_state(e.concat([d]),t,n,i,l),0==d&&(a=i.getChildAt(i.numChildren-1),s.addPoint(a.x,a.y+a.height/2)),n=deal_then_state(e.concat([d+1]),t,n,i,l),r-(d+2)>=2&&(n=output_con("   否则如果   ",n,i,l,e.concat([d+2])),a=i.getChildAt(i.numChildren-1),s.addPoint(a.x,a.y+a.height/2))}return n=output_con(" 结束 ",n,i,l,e.slice(0,e.length-1)),a=i.getChildAt(i.numChildren-1),s.addPoint(a.x,a.y+a.height/2),s.drawLines(),n}function deal_if_state(e,t,n,i,l){var a=(get_entry_array(e),padding.line2Frame,Laya.Pool.getItemByClass("FrameBlock",FrameBlock));a.type="cif";var o=Laya.Pool.getItemByClass("LineBlock",LineBlock);o.type="condition",a.indexID=e.slice(),o.indexID=e.slice(),i.addChild(a);var r=l>1?padding.ifelseIndent+padding.conFramGap:padding.ifelseIndent;a.pos(r,n);var s=max_lenX-(a.localToGlobal({x:0,y:0}).x+t)-padding.conFramGap-padding.frameR*l-padding.frameR;return a.setFrameSize(s,o.height+2*padding.line2Frame),a.addChild(o),o.pos(padding.lineIfIndent,(a._fheight-o.height)/2),parse_line(e.concat(["subs"]),padding.blockLR,o,null),o.lwidth=max_lenX-(o.localToGlobal({x:0,y:0}).x+t)-padding.frameR*l-padding.lineLR-padding.frameR,n+a._fheight+padding.frame2Frame}function deal_then_state(e,t,n,i,l){var a=get_entry_array(e),o=padding.frame2Frame,r=!1,s=Laya.Pool.getItemByClass("FrameBlock",FrameBlock);s.type="cthen",s.indexID=e.slice(),i.addChild(s);var d=l>1?padding.ifelseIndent+padding.conFramGap:padding.ifelseIndent;s.pos(d,n);for(var c=0;c<a.length;c++){var u=a[c].block;if("line"==u){var p=Laya.Pool.getItemByClass("LineBlock",LineBlock);p.type="normal",p.indexID=e.concat([c]),s.addChild(p),p.pos(padding.lineIfIndent,o),parse_line(e.concat([c,"subs"]),padding.blockLR,p,null),p.lwidth=max_lenX-(p.localToGlobal({x:0,y:0}).x+t)-padding.frameR*l-padding.blockLR-padding.frameR,o+=p.height+padding.lineInter,r=!0}else r&&(o+=padding.frame2Frame-padding.lineInter),o="ifelse"==u?deal_ifelse(e.concat([c,"subs"]),t,o,s,l+1):deal_loop(u,e.concat([c,"subs"]),t,o,s,l+1),r=!1}r&&(o+=padding.line2Frame-padding.lineInter);var _=max_lenX-(s.localToGlobal({x:0,y:0}).x+t)-padding.conFramGap-padding.frameR*l-padding.frameR;return s.setFrameSize(_,o),n+s._fheight+padding.frame2Frame}function output_con(e,t,n,i,l){var a=Laya.Pool.getItemByClass("Block",Block);a.init(e,"ifState"),n.addChild(a);var o=i>1?padding.conBlockIndent+padding.conFramGap:padding.conBlockIndent;return a.pos(o,t),a.indexID=l,t+a.height+padding.frame2Frame}function parse_line(e,t,n,i,l){if(4==arguments.length)var l=[dConst.beginningOL,null,null];var a=get_entry_array(e),o=n.localToGlobal({x:0,y:0}),r=get_curr_box();if(!isNaN(o.y)&&!(o.y<0&&o.y+n.height<0||o.y>r.localToGlobal({x:0,y:r.height}).y)){var s,d,c,u,p,_=e_result=0,h=t,b=!0,m=null,g=!0;t==padding.blockLR&&(b=!1),"subFunc"==e[0]&&(m=e[1]);for(var y=0,f=a.length;f>y;y++){if(p=null,null!=i&&y<(i.length-2)/2){if(""!=i[2*(y+1)]){var k=Laya.Pool.getItemByClass("Block",Block);k.init(i[2*(y+1)],"plainTxt"),k.pos(h-padding.blockInter,(n.height-k.height)/2),n.addChild(k),h+=k.width-padding.blockInter}l[0]=i[2*(y+1)+1]}if(isArray(a[y]))l[2]=l[0],h=parse_line(e.concat([y]),h,n,null,l)+padding.blockInter;else{s=Laya.Pool.getItemByClass("Block",Block),s.indexID=e.concat([y]),d=a[y].type;var x=null;if(a[y].hasOwnProperty("name")?(c=type2prop[d][a[y].name][0],u=type2prop[d][a[y].name][1],x=a[y].name):a[y].hasOwnProperty("value")?(c=a[y].value,u=dConst.inputNum):a[y].hasOwnProperty("id")&&(c=getBlockIdTxt(d,a[y].id,m),"subFunc"==d?u=dConst.libGetNum:(p=getBlockIdType(a[y],m),u=type2prop[d][p][1])),"__errorID"==c)s.init(" 无此元素 ","errID"),l=[null,"unSelect",null];else{_=syntax_check(l,x,u,n,g,b);var v=null==p?d:p;y==f-1?e_result=endding_check(v):"logical"==a[y+1].type&&(e_result=endding_check(v)),0==_&&0==e_result?s.init(c,d):s.init(c,"errID")}if(_=e_result=0,u!=dConst.opAssign&&u!=dConst.opComp||(g=!1),"logical"==d&&(g=!0),s.pos(h,(n.height-s.height)/2),o=s.localToGlobal({x:0,y:0}),o.x<0&&o.x+s.width<0&&(s.visible=!1),n.addChild(s),h+=s.width+padding.blockInter,a[y].hasOwnProperty("args")){h=bracket_output("（",h,n);var B=null;if("subFunc"!=d)B=type2prop[d][a[y].name];else{B=["",""];for(var C=jsonObj.subFunc,I={number:dConst.argNumber,array:dConst.argArray},w=0,L=C.length;L>w&&C[w].id!=a[y].id;w++);if(w>=L)B=null;else{C=jsonObj.subFunc[w];for(var w=0,L=C.parameter.length;L>w;w++)B=B.concat(["参数"+(w+1)+" :",I[C.parameter[w].type]])}}h=parse_line(e.concat([y,"args"]),h,n,B,[null,d,null]),h=bracket_output("）",h,n)}a[y].hasOwnProperty("arrayIndex")&&(h=bracket_output(" [",h,n),h=parse_line(e.concat([y,"arrayIndex"]),h,n,null,[dConst.argNumber,d,dConst.argNumber]),h=bracket_output(" ] ",h,n)),l[0]=u,l[1]=null==p?d:p}}return"condition"!=n.type||"cif"!=n.parent.type&&"whiledo"!=n.parent.type||b||(s=Laya.Pool.getItemByClass("Block",Block),s.init("▼","logical"),s.pos(h,(n.height-s.height)/2),n.addChild(s),s.indexID=e.slice(0,e.length-1),h+=s.width+padding.blockInter),h-padding.blockInter}}function endding_check(e){var t=["opreator","periObj","tupleI"],n=t.indexOf(e);return-1!=n?"err_"+t[n]:0}function syntax_check(e,t,n,i,l,a){if("unSelect"==e[1])return 0;if(n==dConst.nonExist)return 0;if(n==dConst.opComp||n==dConst.opAssign){if(!l)return"err_CAOP";if(a)return"err_argOP"}var o=["newBlock","and","or"];if(-1!=o.indexOf(t))return 0;var r={periObj:[{dtype:dConst.argNumber,filter:[dConst.objGetNum]},{dtype:dConst.argArray,filter:[null]}],array:[{dtype:dConst.argNumber,filter:[null]},{dtype:dConst.argArray,filter:[null]}]},s=[null],d=prefixFilter[1];"condition"==i.type&&(d=prefixFilter[0]);for(var c=0;c<d.length;c++)if(d[c].prefix==e[0]){if(d[c].hasOwnProperty("nfilter")){for(var u=0,p=d[c].nfilter.length;p>u&&t!=d[c].nfilter[u];u++);if(u>=p)return"err_method"}s=d[c].filter;break}if(e[1]in r)for(var c=0;c<r[e[1]].length;c++)e[2]==r[e[1]][c].dtype&&(s=r[e[1]][c].filter);for(var c=0,p=s.length;p>c;c++)if(n==s[c])return 0;return"err_type"}function bracket_output(e,t,n){var i=Laya.Pool.getItemByClass("Block",Block);return i.init(e,"plainTxt"),n.addChild(i),"（"==e||" ["==e?(i.pos(t-padding.blockInter,(n.height-i.height)/2),t+=i.width-padding.blockInter):(i.pos(t,(n.height-i.height)/2),t+=i.width),t}function getBlockIdTxt(e,t,n){var i={globalVar:function(){for(var e in jsonObj.globalVar)if(jsonObj.globalVar[e].id==t)return jsonObj.globalVar[e].name;return"__errorID"},subFunc:function(){for(var e in jsonObj.subFunc)if(jsonObj.subFunc[e].id==t)return jsonObj.subFunc[e].name;return"__errorID"},localVar:function(){var e=jsonObj.subFunc[n].localVar;for(var i in e)if(e[i].id==t)return e[i].name;return"__errorID"},parameter:function(){var e=jsonObj.subFunc[n].parameter;for(var i in e)if(e[i].id==t)return e[i].name;return"__errorID"}};if("function"!=typeof i[e])throw new Error("Invalid type.");return i[e]()}function getBlockIdType(e,t){var n,i=e.type,l=e.id,a={globalVar:function(){for(var t in jsonObj.globalVar)if(jsonObj.globalVar[t].id==l)return n=jsonObj.globalVar[t].type,e.hasOwnProperty("arrayIndex")&&(n+="I"),n;return"__errorID"},localVar:function(){var i=jsonObj.subFunc[t].localVar;for(var a in i)if(i[a].id==l)return n=i[a].type,e.hasOwnProperty("arrayIndex")&&(n+="I"),n;return"__errorID"},parameter:function(){var i=jsonObj.subFunc[t].parameter;for(var a in i)if(i[a].id==l)return n=i[a].type,e.hasOwnProperty("arrayIndex")&&(n+="I"),n;return"__errorID"}};if("function"!=typeof a[i])throw new Error("Invalid type.");return a[i]()}function change_skin(){stage_skin=!stage_skin,set_stage_skin()}function clear_selected_block(){null!=selectedBlock&&(selectedBlock.selected=!1,selectedBlock=null),menu_box.getChildAt(0).disabled=!1}function refresh_curr_page(){1==mainBlock_box.visible?(get_main_maxXY(),max_lenX=mainBlock_box.maxX,max_lenY=mainBlock_box.maxY,clear_all_children(mainBlock_box),max_lenX-mainBlock_box.currX<mainBlock_box.width&&(mainBlock_box.currX=max_lenX-mainBlock_box.width),max_lenY+mainBlock_box.currY<mainBlock_box.height&&(mainBlock_box.currY=mainBlock_box.height-max_lenY),refresh_main_blocks(mainBlock_box.currX,mainBlock_box.currY)):(get_sub_maxXY(),max_lenX=subBlock_box.maxX,max_lenY=subBlock_box.maxY,clear_all_children(subBlock_box),max_lenX-subBlock_box.currX<subBlock_box.width&&(subBlock_box.currX=max_lenX-subBlock_box.width),max_lenY+subBlock_box.currY<subBlock_box.height&&(subBlock_box.currY=subBlock_box.height-max_lenY),refresh_sub_blocks(subBlock_box.currX,subBlock_box.currY))}function block_deal_hit(e){e.stopPropagation();var t,n,i=e.target;console.log("selected block:",i.indexID,i.type,i);var l=subBlock_box;if(0==subBlock_box.visible&&(l=mainBlock_box),"plainTxt"==i.type||"noSelect"==i.type||"plain"==i.type)return clear_selected_block(),void disable_all_menu();if("varType"==i.type){clear_selected_block(),i.selected=!0,selectedBlock=i;var a=i.localToGlobal({x:0,y:i.height});return pop_var_type.setItemsRect(a.x+i.width/2-padding.pop1Width/2,a.y+6,padding.pop1Width,padding.pop1Height),pop_var_type.visible=!0,void disable_all_menu()}if("varAdd"==i.type){var o={globalVar:"全局变量",localVar:"局部变量",parameter:"子函数参数"};clear_selected_block(),t=get_entry_array(i.indexID);var r,s;s=0==t.length?0:t[t.length-1].id+1;var d=i.indexID[i.indexID.length-1],c=o[d]+(s+1)+"号";return r="parameter"==d?{type:"number",name:c,id:s}:{type:"number",name:c,value:"0",id:s},t.push(r),disable_all_menu(),void refresh_curr_page()}if("arrayAdd"==i.type)return clear_selected_block(),n=i.indexID.slice(),t=get_entry_array(n),t.push({type:"number",value:"0"}),disable_all_menu(),void refresh_curr_page();if("logical"==i.type&&"▼"==i.text){clear_selected_block(),i.selected=!0,selectedBlock=i;var a=i.localToGlobal({x:0,y:i.height});return pop_logical.setItemsRect(a.x+i.width/2-padding.pop1Width/2,a.y+padding.lineInter,padding.pop1Width,padding.pop1Height),pop_logical.visible=!0,void disable_all_menu()}if("ifState"==i.type&&" 结束 "==i.text){if(n=i.indexID.slice(),t=get_entry_array(n),t.subs.length%2==0){clear_selected_block(),i.selected=!0,selectedBlock=i;var a=i.localToGlobal({x:0,y:i.height}),u=a.y+padding.lineInter,l=get_curr_box();u+padding.pop1Height>l.localToGlobal({x:0,y:l.height}).y&&(u=a.y-i.height-padding.lineInter-padding.pop1Height),pop_ifstate.setItemsRect(a.x+i.width/2-padding.pop1Width/2,u,padding.pop1Width,padding.pop1Height),pop_ifstate.visible=!0}else clear_selected_block();return void disable_all_menu()}if(i===selectedBlock){if("LineBlock"==i.__pollClass||"FrameBlock"==i.__pollClass)return i.selected=!1,selectedBlock=null,void disable_all_menu();if("logical"==i.type){var a=i.localToGlobal({x:0,y:i.height});return pop_logical.setItemsRect(a.x+i.width/2-padding.pop1Width/2,a.y+padding.lineInter,padding.pop1Width,padding.pop1Height),pop_logical.visible=!0,void disable_all_menu()}if("ifState"==i.type){var a=i.localToGlobal({x:0,y:i.height}),u=a.y+padding.lineInter,l=get_curr_box();return u+padding.pop1Height>l.localToGlobal({x:0,y:l.height}).y&&(u=a.y-i.height-padding.lineInter-padding.pop1Height),pop_ifstate.setItemsRect(a.x+i.width/2-padding.pop1Width/2,u,padding.pop1Width,padding.pop1Height),pop_ifstate.visible=!0,void disable_all_menu()}if(-1!=i.type.search(/Input$/))return disable_all_menu(),input_block.color=i.color,input_block.font=i.font,input_block.fontSize=i.fontSize,input_block.text=i.text,input_block.width=i.width-20,input_block.height=i.height,input_block.pos(i.localToGlobal({x:0,y:0}).x+10,i.localToGlobal({x:0,y:0}).y),input_block.visible=!0,input_block.focus=!0,input_block._targetBlock=i,input_block.type="txt",input_block.maxChars=24,i._origenColor=i.color,i.color="rgba(255,255,255,0)",i._inputing=!0,$("#layaContainer>div>input").attr({maxlength:24,onkeyup:"if(isNaN(value))execCommand('undo')",onafterpaste:"if(isNaN(value)) execCommand('undo')"}),"numInput"!=i.type&&($("#layaContainer>div>input").removeAttr("onkeyup"),$("#layaContainer>div>input").removeAttr("onafterpaste"),$("#layaContainer>div>input").attr("maxlength",16)),void input_change();disable_all_menu();var p=getPrefix(i),_=getMenuItem(p);popup_SCM(_)}else if(null!=selectedBlock&&(selectedBlock.selected=!1),i.selected=!0,selectedBlock=i,disable_all_menu(),set_menu_active(menu_box,eMenu.enew,!1),"Block"==selectedBlock.__pollClass){if(n=selectedBlock.indexID.slice(),t=get_entry_array(n),"forin"==selectedBlock.parent.parent.type&&(selectedBlock.parent.getChildAt(1)==selectedBlock||selectedBlock.parent.getChildAt(3)==selectedBlock))return void set_menu_active(menu_box,eMenu.edelete);if("unSelect"==selectedBlock.type||"ctrlState"==selectedBlock.type||-1!=selectedBlock.type.search(/Input$/))return void set_menu_active(menu_box,eMenu.edelete);if("logical"==selectedBlock.type)return set_menu_active(menu_box,[eMenu.edelete,eMenu.einsert]),void set_menu_active(insert_menu,iMenu.iblock);if("ifState"==selectedBlock.type)return set_menu_active(menu_box,eMenu.edelete),void(" 结束 "==selectedBlock.text&&set_menu_active(menu_box,eMenu.edelete,!1));if(t.hasOwnProperty("name")){var h=type2prop[t.type][t.name][1];if(h==dConst.objSet||h==dConst.libSet||h==dConst.arraySet)return void set_menu_active(menu_box,[eMenu.edelete,eMenu.egroup])}if("args"!=selectedBlock.indexID[selectedBlock.indexID.length-2]){n=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),t=get_entry_array(n);var b=selectedBlock.indexID[selectedBlock.indexID.length-1];if(t.length-1>b&&"unSelect"==t[b+1].type)return void set_menu_active(menu_box,eMenu.edelete)}set_menu_active(insert_menu,iMenu.iblock),set_menu_active(menu_box,[eMenu.einsert,eMenu.edelete,eMenu.egroup])}else if("LineBlock"==selectedBlock.__pollClass){if(set_menu_active(menu_box,[eMenu.edelete,eMenu.einsert]),set_menu_active(insert_menu,iMenu.iblock),"cif"==selectedBlock.parent.type)return void(1==selectedBlock.numChildren&&"unSelect"==selectedBlock.getChildAt(0).type&&(set_menu_active(insert_menu,iMenu.iblock,!1),set_menu_active(menu_box,eMenu.einsert,!1)));"unSelect"==selectedBlock.getChildAt(0).type&&set_menu_active(insert_menu,iMenu.iblock,!1),"subFunc"==selectedBlock.indexID[0]&&set_menu_active(insert_menu,iMenu.ireturn);for(var m=selectedBlock.parent,g=!1;"funcFrame"!=m.type;){if("forin"==m.type||"whiledo"==m.type){g=!0;break}m=m.parent}g&&set_menu_active(insert_menu,[iMenu.ibreak,iMenu.icontinue]),("forin"==selectedBlock.parent.type&&"condition"==selectedBlock.type||"unSelect"==selectedBlock.getChildAt(0).type)&&set_menu_active(insert_menu,iMenu.iblock,!1),set_menu_active(insert_menu,[iMenu.iifelse,iMenu.iforin,iMenu.iwhiledo,iMenu.iline])}else{var y=["globalVar","localVar","parameter"];if(-1!=y.indexOf(selectedBlock.type)||"cthen"==selectedBlock.type)return void set_menu_active(menu_box,eMenu.edelete);if("cif"==selectedBlock.type&&0!=selectedBlock.indexID[selectedBlock.indexID.length-1])return void set_menu_active(menu_box,eMenu.edelete);if(set_menu_active(menu_box,[eMenu.einsert,eMenu.edelete]),set_menu_active(insert_menu,iMenu.iline),"funcFrame"==selectedBlock.type)return;"subFunc"==selectedBlock.indexID[0]&&set_menu_active(insert_menu,iMenu.ireturn);var m=selectedBlock.parent,g=!1;if("funcFrame"!=selectedBlock.type)for(;"funcFrame"!=m.type;){if("forin"==m.type||"whiledo"==m.type){g=!0;break}m=m.parent}g&&set_menu_active(insert_menu,[iMenu.ibreak,iMenu.icontinue]),set_menu_active(insert_menu,[iMenu.iifelse,iMenu.iforin,iMenu.iwhiledo])}}function popup_SCM(e){var t,n,i;i=selectedBlock.localToGlobal({x:0,y:0}),t=i.x+selectedBlock.width+Laya.stage._canvasTransform.tx+20,n=i.y+Laya.stage._canvasTransform.ty,t+padding.sMenuWidth>Laya.stage.width+Laya.stage._canvasTransform.tx&&(t=t-selectedBlock.width-40-padding.sMenuWidth),n+padding.sMenuHeight>Laya.stage.height+Laya.stage._canvasTransform.ty&&(n-=padding.sMenuHeight),$(".modal").find(".modal-body").empty(),$(".modal").find(".modal-body").append(e),$(".modal").css({"padding-top":n,"padding-left":t,display:"block"}),$(".mitem").on("click",function(){var e=$(this).data("mitem");modify_json_block(e)}),$(".mtrunk").eq(0).find(".mtrunk_i").removeClass("mtrunk_icon"),$(".mtrunk").eq(0).find("ul").eq(0).show(),$(".mtrunk2").find("ul").show(),$(".mtrunk").find(".mtrunk_span").click(function(e){e.stopPropagation(),$(this).next("ul").toggle(),$(this).parent(".mtrunk").find(".mtrunk_i").hasClass("mtrunk_icon")?$(this).parent(".mtrunk").find(".mtrunk_i").removeClass("mtrunk_icon"):$(this).parent(".mtrunk").find(".mtrunk_i").addClass("mtrunk_icon")}),$(".mtrunk2").find("span").click(function(e){e.stopPropagation(),$(this).next("ul").toggle(),$(this).parent(".mtrunk2").find("i").hasClass("mtrunk_icon")?$(this).parent(".mtrunk2").find("i").removeClass("mtrunk_icon"):$(this).parent(".mtrunk2").find("i").addClass("mtrunk_icon")})}function disable_all_menu(){for(var e=1;e<menu_box.numChildren;e++)menu_box.getChildAt(e).disabled=!0;for(set_menu_active(menu_box,eMenu.enew,!0),e=0;e<insert_menu.numChildren;e++)insert_menu.getChildAt(e).disabled=!0}function block_box_hited(e){e.target==this&&(null!=selectedBlock&&(selectedBlock.selected=!1,selectedBlock=null),disable_all_menu())}function set_menu_active(e,t,n){if(arguments.length<3)var n=!0;if(isArray(t))for(var i=0;i<t.length;i++)e.getChildAt(t[i]).disabled=!n;else e.getChildAt(t).disabled=!n}function getMenuItem(e){var t=e[0],n=e[1];if(e[2],t==dConst.newBlock)return'<div class="mtrunk"><span class="mtrunk_span">请先选择前一项！</span></div>';var i=null,l="",a=prefixFilter[1];n&&(a=prefixFilter[0]);for(var o=0;o<a.length;o++)a[o].prefix==t&&(i=a[o].filter);if(null==i)return'<div class="mtrunk"><span class="mtrunk_span">无有效内容可供选择！</span></div>';-1!=i.indexOf(dConst.inputNum)?($(".modal-content").css({paddingTop:"60px"}),$(".close").css({top:"24px"}),l+=createInputnum()):($(".modal-content").css({paddingTop:"35px"}),$(".close").css({top:"8px"}));for(var o in menuDefine)l+=createHTML(menuDefine[o],i,e);return""==l&&(html='<div class="mtrunk"><span class="mtrunk_span">无有效内容可供选择！</span></div>'),l}function createInputnum(){var e="<div class='input_box'><input type='text' maxlength='32' onkeyup='if(isNaN(value))execCommand(\"undo\")' onafterpaste='if(isNaN(value))execCommand(\"undo\")' /><a href='#'>确定</a></div>";return e}function modify_json_block(e){if($(".modal").css("display","none"),null!=selectedBlock){delete e.txt;var t=selectedBlock.indexID[selectedBlock.indexID.length-1],n=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),i=get_entry_array(n);i.splice(t,1,e);var l=selectedBlock.indexID.slice();if(selectedBlock.selected=!1,selectedBlock=null,disable_all_menu(),refresh_curr_page(),auto_insert){if(e.hasOwnProperty("name")){var a=[dConst.libSet,dConst.arraySet,dConst.objSet],o=type2prop[e.type][e.name][1];if(-1!=a.indexOf(o))return void(auto_insert=!1)}var r=get_curr_box();selectedBlock=get_sameID_block(r,l),selectedBlock.selected=!0,block_insert_ani()}}}function createHTML(e,t,n){var i=n[2];if(e.hasOwnProperty("getItemFunc"))return e.getItemFunc(e.name,t,n);for(var l,a='<div class="mtrunk"><i class="mtrunk_i mtrunk_icon"></i><span class="mtrunk_span">'+e.name+"</span></div>",o="",r=e.subItem,s=0;s<r.length;s++)if(r[s].hasOwnProperty("name"))o+=createHTML(r[s],t,i,n);else{l=type2prop[r[s].index[0]][r[s].index[1]];for(var d in t)if(t[d]==l[1]){if(r[s].hasOwnProperty("filter")&&-1==r[s].filter.indexOf(n[0]))continue;if(o+='<li class="mitem" data-mitem=\'{"type":"'+r[s].index[0]+'","name":"'+r[s].index[1]+'"',l.length>2){o+=',"args":[';for(var c=0;c<(l.length-2)/2;c++)o+='{"type":"unSelect","name":"newBlock"}',c<(l.length-2)/2-1&&(o+=",");o+="]"}o+="}'>"+l[0]+"</li>";break}}return""!=o?a='<div class="mtrunk"><i class="mtrunk_i mtrunk_icon"></i><span class="mtrunk_span">'+e.name+"</span><ul>"+o+"</ul></div>":""}function get_subfunc_param(e,t){for(var n={number:dConst.argNumber,array:dConst.argArray},i=0,l=jsonObj.subFunc.length;l>i&&jsonObj.subFunc[i].id!=e;i++);if(i>=l)return null;for(var a=jsonObj.subFunc[e].parameter,o=0,l=a.length;l>o&&a[o].id!=t;o++);return o>=l?null:n[a[o].type]}function getPrefix(e){var t,n,i,l=null,a=e.indexID.slice(),o=[null,!1,null,[null,null,null]],r=e.parent;if("condition"==r.type&&(o[1]=!0),"subFunc"==a[0]&&(l=a[1],o[2]=l),"forin"==e.parent.parent.type&&"condition"==e.parent.type){if(e.parent.getChildAt(1)===e)return o[0]=dConst.forin1st,o;if(e.parent.getChildAt(3)===e)return o[0]=dConst.forin2nd,o}var s=0;return"plainTxt"==r.getChildAt(0).type&&(s=1),r.getChildAt(s)===e?(o[0]=dConst.beginningOL,o):"args"==a[a.length-2]?(t=get_entry_array(a.slice(0,a.length-2)),"subFunc"!=t.type?o[0]=type2prop[t.type][t.name][2+2*a[a.length-1]+1]:o[0]=get_subfunc_param(t.id,a[a.length-1]),o[3]=[dConst.opArith,null,null],o):"arrayIndex"==a[a.length-2]&&0==a[a.length-1]?(o[0]=dConst.argNumber,o[3]=[dConst.opArith,null,null],o):"args"==a[a.length-3]&&0==a[a.length-1]?(t=get_entry_array(a.slice(0,a.length-3)),"subFunc"!=t.type?o[0]=type2prop[t.type][t.name][2+2*a[a.length-1]+1]:o[0]=get_subfunc_param(t.id,a[a.length-1]),o[3]=[dConst.opArith,null,null],o):(t=get_entry_array(a.slice(0,a.length-1).concat([a[a.length-1]-1])),n=t.type,"number"==n?(o[0]=dConst.inputNum,o):"subFunc"==n?(o[0]=dConst.libGetNum,o):(t.hasOwnProperty("name")&&(i=t.name),t.hasOwnProperty("id")&&(i=getBlockIdType(t,l)),"__errorID"!=i&&(o[0]=type2prop[n][i][1]),o))}function getGlobalVarItem(e,t,n){var i,l,a,o=jsonObj.globalVar,r='<div class="mtrunk"><i class="mtrunk_i mtrunk_icon"></i><span class="mtrunk_span">'+e+"</span></div>",s="";for(var d in o){i=varProp[o[d].type],l=o[d].name;for(var c in t)if(t[c]==i){a=i==dConst.varArray?n[0]==dConst.beginningOL?0==n[1]?"both":"index":n[0]==dConst.argArray?"variabile":"index":i==dConst.varTuple?n[0]==dConst.argArray?"variabile":"index":"variabile";var u={variabile:'<li class="mitem" data-mitem=\'{"type":"globalVar","id":'+o[d].id+"}'>"+l+"</li>",index:'<li class="mitem" data-mitem=\'{"type":"globalVar","id":'+o[d].id+',"arrayIndex":[{"type":"unSelect","name":"newBlock"}]}\'>'+l+"</li>",both:'<div class="mtrunk2"><i></i><span>'+l+'</span><ul><li class="mitem" data-mitem=\'{"type":"globalVar","id":'+o[d].id+',"arrayIndex":[{"type":"unSelect","name":"newBlock"}]}\'>使用数组下标</li><li class="mitem" data-mitem=\'{"type":"globalVar","id":'+o[d].id+"}'>使用数组变量</li></ul></div>"};s+=u[a];break}}return""!=s?r='<div class="mtrunk"><i class="mtrunk_i mtrunk_icon"></i><span class="mtrunk_span">'+e+"</span><ul>"+s+"</ul></div>":""}function getLocalVarItem(e,t,n){var i=n[2];if(null==i)return"";var l,a,o=jsonObj.subFunc[i].localVar,r='<div class="mtrunk"><i class="mtrunk_i mtrunk_icon"></i><span class="mtrunk_span">'+e+"</span></div>",s="";for(var d in o){l=varProp[o[d].type],a=o[d].name;for(var c in t)if(t[c]==l){l==dConst.varArray?n[0]==dConst.beginningOL?0==n[1]?html_type="both":html_type="index":n[0]==dConst.argArray?html_type="variabile":html_type="index":html_type="variabile";var u={variabile:'<li class="mitem" data-mitem=\'{"type":"localVar","id":'+o[d].id+"}'>"+a+"</li>",index:'<li class="mitem" data-mitem=\'{"type":"localVar","id":'+o[d].id+',"arrayIndex":[{"type":"unSelect","name":"newBlock"}]}\'>'+a+"</li>",both:'<div class="mtrunk2"><i></i><span>'+a+'</span><ul><li class="mitem" data-mitem=\'{"type":"localVar","id":'+o[d].id+',"arrayIndex":[{"type":"unSelect","name":"newBlock"}]}\'>使用数组下标</li><li class="mitem" data-mitem=\'{"type":"localVar","id":'+o[d].id+"}'>使用数组变量</li></ul></div>"};s+=u[html_type];break}}return""!=s?r='<div class="mtrunk"><i class="mtrunk_i mtrunk_icon"></i><span class="mtrunk_span">'+e+"</span><ul>"+s+"</ul></div>":""}function getParamItem(e,t,n){var i=n[2];if(null==i)return"";var l,a,o=jsonObj.subFunc[i].parameter,r='<div class="mtrunk"><i class="mtrunk_i mtrunk_icon"></i><span class="mtrunk_span">'+e+"</span></div>",s="";for(var d in o){l=varProp[o[d].type],a=o[d].name;for(var c in t)if(t[c]==l){l==dConst.varArray?n[0]==dConst.beginningOL?0==n[1]?html_type="both":html_type="index":n[0]==dConst.argArray?html_type="variabile":html_type="index":html_type="variabile";var u={variabile:'<li class="mitem" data-mitem=\'{"type":"parameter","id":'+o[d].id+"}'>"+a+"</li>",index:'<li class="mitem" data-mitem=\'{"type":"parameter","id":'+o[d].id+',"arrayIndex":[{"type":"unSelect","name":"newBlock"}]}\'>'+a+"</li>",both:'<div class="mtrunk2"><i></i><span>'+a+'</span><ul><li class="mitem" data-mitem=\'{"type":"parameter","id":'+o[d].id+',"arrayIndex":[{"type":"unSelect","name":"newBlock"}]}\'>使用数组下标</li><li class="mitem" data-mitem=\'{"type":"parameter","id":'+o[d].id+"}'>使用数组变量</li></ul></div>"};s+=u[html_type];break}}return""!=s?r='<div class="mtrunk"><i class="mtrunk_i mtrunk_icon"></i><span class="mtrunk_span">'+e+"</span><ul>"+s+"</ul></div>":""}function getSubfuncItem(e,t){var n=jsonObj.subFunc,i='<div class="mtrunk"><i class="mtrunk_i mtrunk_icon"></i><span class="mtrunk_span">'+e+"</span></div>",l="",a=!1;for(var o in t)t[o]==dConst.libGetNum&&(a=!0);if(a){for(var o in n){if(l+='<li class="mitem" data-mitem=\'{"type":"subFunc","id":'+n[o].id,n[o].parameter.length>0){l+=',"args":[';for(var r in n[o].parameter)l+='{"type":"unSelect","name":"newBlock"}',r<n[o].parameter.length-1&&(l+=",");l+="]"}l+="}'>"+n[o].name+"</li>"}if(""!=l)return i='<div class="mtrunk"><i class="mtrunk_i mtrunk_icon"></i><span class="mtrunk_span">'+e+"</span><ul>"+l+"</ul></div>"}return""}function input_over(){if(0!=input_block.visible){var e,t,n,i=input_block._targetBlock,l=input_block.text,a={globalVarInput:"全局变量",localVarInput:"局部变量",parameterInput:"子函数参数",strInput:"子函数"};""==l&&(l="numInput"==i.type?"0":a[i.type]+(i.indexID[i.indexID.length-2]+1)+"号"),i._inputing=!1,"strInput"!=i.type&&(i.parent.scrollRect=null),input_block.visible=!1,e=i.indexID[i.indexID.length-1],"numInput"==i.type?(t=i.indexID.slice(0,i.indexID.length-2),n=get_entry_array(t),isArray(n.value)?n.value.splice(e,1,{type:"number",value:l}):n.value=l):(t=i.indexID.slice(0,i.indexID.length-1),n=get_entry_array(t),n.name=l),refresh_curr_page()}}function input_enter(){input_block._targetBlock.selected=!1,selectedBlock=null,input_block.focus=!1}function input_change(){if(0!=input_block.visible){var e=input_block._targetBlock;e.text=input_block.text;var t=e.getTxtWidth(),n=mainBlock_box.currX,i=3*padding.lineLR;if(input_block.width=t>0?t:20,"strInput"!=e.type){e.parent.scrollRect=new Laya.Rectangle(0,0,e.parent.width,e.parent.height);var l=get_txt_width(e.text);e.width=l;for(var a=0;a<e.parent.numChildren&&e!==e.parent.getChildAt(a);a++);for(a+=1;a<e.parent.numChildren;a++)e.parent.getChildAt(a).x=e.parent.getChildAt(a-1).x+e.parent.getChildAt(a-1).width+padding.lineLR;if(0==mainBlock_box.visible&&(n=subBlock_box.currX),n+mainBlock_box.width<max_lenX&&(i=padding.lineLR),e.localToGlobal({x:e.width,y:0}).x+i>mainBlock_box.width){for(i=e.localToGlobal({x:e.width,y:0}).x+i-mainBlock_box.width+20,a=0;a<e.parent.numChildren;a++)e.parent.getChildAt(a).x-=i;input_block.x=e.localToGlobal({x:0,y:0}).x+10}}}}function set_stage_skin(){Laya.stage.graphics.clear(),stage_skin?Laya.stage.graphics.fillTexture(Laya.loader.getRes("psv/bg1.jpg"),0,0,Laya.stage.width,Laya.stage.height,"repeat"):Laya.stage.bgColor="rgb(5,25,46)",Laya.stage.graphics.drawTexture(Laya.loader.getRes("psv/bg.png"),0,0,Laya.stage.width,Laya.stage.height),Laya.stage.repaint()}function isArray(e){return"[object Array]"===Object.prototype.toString.call(e)}Laya.Config.isAntialias=!0,Laya.init(),Laya.stage.width=1280,Laya.stage.height=Laya.Browser.height,Laya.stage.scaleMode="noscale",Laya.stage.alignH="center",Laya.stage.alignV="middle",Laya.stage.screenMode="none";var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},MAX_ZORDER=100,Block=function(e){function t(){e.call(this),this.indexID=[],this._inputing=!1,this._radius=10,this.__type="default",this.on("mouseover",this,this.onMouseHover),this.on("mouseout",this,this.onMouseLeave),Object.defineProperty(this,"selected",{get:function(){return this.__selected},set:function(e){this.__selected!=Boolean(e)&&(this.__selected=Boolean(e),this.isChanged=!0)}}),Object.defineProperty(this,"type",{get:function(){return this.__type},set:function(e){this.__type!=e&&(this.__type=e,this.isChanged=!0)}})}return __extends(t,e),t.prototype.init=function(e,t){this.__selected=!1,this.__pollClass="Block",this.text=e,this.height=32,this.align="center",this.valign="middle",this.font="微软雅黑",this.fontSize=16,this.padding=[5,0,15,0],this.color="rgba(255,255,255,0.9)";var n=Math.ceil(this.getTxtWidth())+2*this._radius;this.width=n<=2*this.radius?2*this.radius+10:n,this.type=t},t.prototype.__customDraw=function(){var e;e=this.__type in this._typetbl?this._typetbl[this.__type]:[0,"rgba(102,153,153,1)","rgba(102,153,153,0.2)","rgba(102,153,153,0.6)"];var t=Math.ceil(this.getTxtWidth())+2*this._radius;if(this.width=t<=2*this.radius?2*this.radius+10:t,
-1!=e[0]){var n=[[["moveTo",this._radius,0],["lineTo",this.width-this._radius,0],["arcTo",this.width,0,this.width,this._radius,this._radius],["arcTo",this.width,this.height,this.width-this._radius,this.height,this._radius],["arcTo",0,this.height,0,this.height-this._radius,this._radius],["arcTo",0,0,this._radius,0,this._radius]],[["moveTo",0,0],["lineTo",this.width,0],["lineTo",this.width,this.height],["lineTo",0,this.height],["closePath"]],[["moveTo",this.width/2,0],["lineTo",this.width,this.height/2],["lineTo",this.width/2,this.height],["lineTo",0,this.height/2],["closePath"]]];this.__selected?this.graphics.drawPath(0,0,n[e[0]],{fillStyle:e[3]},{strokeStyle:e[1]}):this.graphics.drawPath(0,0,n[e[0]],{fillStyle:e[2]},{strokeStyle:e[1]})}},t.prototype.getTxtWidth=function(){return Laya.Browser.context.font=""+this.fontSize+"px "+this.font,Laya.Browser.context.measureText(this.text).width},t.prototype.onMouseHover=function(){this._inputing||"plainTxt"==this.__type||"bracket"==this.__type||"noSelect"==this.__type||$("#layaCanvas").css("cursor","pointer")},t.prototype.onMouseLeave=function(){$("#layaCanvas").css("cursor","default")},t.prototype.breset=function(){},t.prototype._typetbl={periObj:[0,"rgba(51,153,255,1","rgba(51,153,255,0.2)","rgba(51,153,255,0.6)"],number:[0,"rgba(100,116,135,1)","rgba(100,116,135,0.2)","rgba(100,116,135,0.6)"],globalVar:[0,"rgba(168,168,105,1)","rgba(168,168,105,0.2)","rgba(168,168,105,0.6)"],localVar:[0,"rgba(82,153,87,1)","rgba(82,153,87,0.2)","rgba(82,153,87,0.6)"],parameter:[0,"rgba(82,153,87,1)","rgba(82,153,87,0.2)","rgba(82,153,87,0.6)"],ctrlState:[1,"rgba(153,102,51,1)","rgba(153,102,51,0.2)","rgba(153,102,51,0.6)"],opreator:[0,"rgba(204,153,102,1)","rgba(204,153,102,0.2)","rgba(204,153,102,0.6)"],logical:[2,"rgba(153,102,51,1)","rgba(153,102,51,0.2)","rgba(153,102,51,0.6)"],ifState:[2,"rgba(153,102,51,1)","rgba(153,102,51,0.2)","rgba(153,102,51,0.6)"],libFunc:[0,"rgba(99,93,221,1)","rgba(99,93,221,0.2)","rgba(99,93,221,0.6)"],brackets:[-1],plainTxt:[-1],numInput:[0,"rgba(100,116,135,1)","rgba(100,116,135,0.2)","rgba(100,116,135,0.6)"],globalVarInput:[0,"rgba(168,168,105,1)","rgba(168,168,105,0.2)","rgba(168,168,105,0.6)"],localVarInput:[0,"rgba(82,153,87,1)","rgba(82,153,87,0.2)","rgba(82,153,87,0.6)"],parameterInput:[0,"rgba(82,153,87,1)","rgba(82,153,87,0.2)","rgba(82,153,87,0.6)"],errID:[0,"rgba(222,75,85,1)","rgba(222,75,85,0.2)","rgba(222,75,85,0.6)"],unSelect:[0,"rgba(222,75,85,1)","rgba(222,75,85,0.2)","rgba(222,75,85,0.6)"]},t}(Laya.Text),PopMenu=function(e){function t(){e.call(this),this.menuIndex=null,this.width=Laya.stage.width,this.height=Laya.stage.height,this.__pollClass="PopMenu",this._menuNum=0,this._menuItems=[],this._menuItemsRect=[0,0,100,100],this._menuBgColor="#000000",this._menuFgColor="#ffffff",this._borderColor="#ff0000",this._menuBgPic=null,this._mpadding=[0,0,0,0,0],this._autoLayout=!0,this.on("click",this,this.deal_click),Object.defineProperty(this,"menuNum",{get:function(){return this._menuNum},set:function(e){this._menuNum!=parseInt(e)&&(this._menuNum=parseInt(e),this._typesetting(),this._render_menu())}}),Object.defineProperty(this,"autoLayout",{get:function(){return this._autoLayout},set:function(e){this._autoLayout=e,this._render_menu()}}),Object.defineProperty(this,"padding",{get:function(){return this._mpadding},set:function(e){isArray(e)&&(this._mpadding=e,this._render_menu())}}),Object.defineProperty(this,"menuBgColor",{get:function(){return this._menuBgColor},set:function(e){this._menuBgColor=e,this._render_menu()}}),Object.defineProperty(this,"menuFgColor",{get:function(){return this._menuFgColor},set:function(e){this._menuFgColor=e,this._render_menu()}}),Object.defineProperty(this,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor=e,this._render_menu()}}),Object.defineProperty(this,"menuBgPic",{get:function(){return this._menuBgPic},set:function(e){this._menuBgPic=e,this._render_menu()}})}__extends(t,e);var n=t.prototype;return n.setItemsRect=function(){if(4!=arguments.length)return void console.log("4 args need! -- x,y,width,height");for(var e=0;e<arguments.length;e++)this._menuItemsRect[e]=arguments[e];this._typesetting(),this._render_menu()},n._render_menu=function(){if(this._draw_bg(),this._menuItems.length&&null!=this._menuFgColor){var e=this._menuItems[0],t=e.localToGlobal({x:0,y:0});this.graphics.drawRect(t.x+9,t.y+9,e.width-18,e.height-12,this._menuFgColor,null,1)}},n._draw_bg=function(){this.graphics.clear(),null!=this._menuBgPic&&this.graphics.drawTexture(Laya.loader.getRes(this._menuBgPic),this._menuItemsRect[0],this._menuItemsRect[1],this._menuItemsRect[2],this._menuItemsRect[3]),null!=this._borderColor&&null!=this._menuBgColor&&this.graphics.drawRect(this._menuItemsRect[0],this._menuItemsRect[1],this._menuItemsRect[2],this._menuItemsRect[3],this._menuBgColor,this._borderColor,1)},n.addMenuItem=function(e){this.addChild(e),this._menuItems[this._menuItems.length]=e,e.on("mouseover",this,this.onMouseHover),this._typesetting(),this._render_menu()},n._typesetting=function(){for(var e=this._mpadding[0],t=0;t<this._menuItems.length;t++){var n=this._menuNum?this._menuNum:this._menuItems.length;1==this._autoLayout&&(this._menuItems[t].width=this._menuItemsRect[2]-this._mpadding[1]-this._mpadding[3],this._menuItems[t].height=(this._menuItemsRect[3]-this._mpadding[0]-this._mpadding[2])/n),this._menuItems[t].pos(this._menuItemsRect[0]+this._mpadding[3],this._menuItemsRect[1]+e),e+=this._menuItems[t].height+this._mpadding[4]}},n.clearMenuItem=function(){for(var e=0;e<this._menuItems.length;e++)this._menuItems[e].removeSelf();this._menuItems=[],this.off("mouseover",this,this.onMouseHover)},n.onMouseHover=function(e){if(null!=this._menuFgColor&&e.target!==this){for(var t=e.target,n=0;n<this._menuItems.length&&t!==this._menuItems[n];n++);this._draw_bg();var i=t.localToGlobal({x:0,y:0});this.graphics.drawRect(i.x+9,i.y+9,t.width-18,t.height-12,this._menuFgColor,null,1),this.repaint()}},n.deal_click=function(e){if(e.target===this){if(this.mouseX>this._menuItemsRect[0]&&this.mouseX<this._menuItemsRect[0]+this._menuItemsRect[2]&&this.mouseY>this._menuItemsRect[1]&&this.mouseY<this._menuItemsRect[1]+this._menuItemsRect[3])return;this.menuIndex=-1}else{for(var t=0;t<this._menuItems.length&&e.target!==this._menuItems[t];t++);this.menuIndex=t}this.event("menuclick"),this._render_menu(),this.visible=!1},t}(Laya.Sprite),LineBlock=function(e){function t(){e.call(this),this.width=100,this.height=46,this.indexID=[],this.__selected=!1,this.__pollClass="LineBlock",this._radius=20,this.__type=null,this._createListener("click",this,this.deal_click,null,!1,!1),Object.defineProperty(this,"selected",{get:function(){return this.__selected},set:function(e){this.__selected!=Boolean(e)&&(this.__selected=Boolean(e),this.redraw())}}),Object.defineProperty(this,"type",{get:function(){return this.__type},set:function(e){var t=e;t in this._typetbl||(t="normal"),this.__type!=t&&(this.__type=t,this.redraw())}}),Object.defineProperty(this,"lwidth",{get:function(){return this.width},set:function(e){this.width=parseFloat(e),this.redraw()}})}__extends(t,e);var n=t.prototype;return n.redraw=function(){var e=[["moveTo",this._radius,0],["lineTo",this.width-this._radius,0],["arcTo",this.width,0,this.width,this._radius,this._radius],["arcTo",this.width,this.height,this.width-this._radius,this.height,this._radius],["arcTo",0,this.height,0,this.height-this._radius,this._radius],["arcTo",0,0,this._radius,0,this._radius]];this.graphics.clear(),this.__selected?this.graphics.drawPath(0,0,e,{fillStyle:this._typetbl[this.__type][2]},{strokeStyle:this._typetbl[this.__type][0]}):this.graphics.drawPath(0,0,e,{fillStyle:this._typetbl[this.__type][1]},{strokeStyle:this._typetbl[this.__type][0]}),this.repaint()},n._typetbl={normal:["rgb(43,66,87)","rgba(255,255,255,0.02)","rgba(103,204,251,0.2)"],condition:["rgb(153,153,102)","rgba(255,255,255,0.02)","rgba(153,153,102,0.2)"],plain:["rgba(255,255,255,0)","rgba(255,255,255,0)","rgba(255,255,255,0)"]},n.breset=function(){this.indexID=[],this.__selected=!1,this.__type=null},t}(Laya.Sprite),FrameBlock=function(e){function t(){e.call(this),this.indexID=[],this.__type=null,this.__selected=!1,this.__pollClass="FrameBlock",this._fwidth=this._fheight=0,this._side=9,this._trx=20,this.align="center",this.valign="middle",this.font="微软雅黑",this.fontSize=16,this.color="rgba(255,255,255,0.9)",this.on("mouseover",this,this.onMouseHover),this.on("mouseout",this,this.onMouseLeave),Object.defineProperty(this,"selected",{get:function(){return this.__selected},set:function(e){this.__selected!=Boolean(e)&&(this.__selected=Boolean(e),this.isChanged=!0)}}),Object.defineProperty(this,"type",{get:function(){return this.__type},set:function(e){return!e in this._typetbl?void console.log("Conditional block type error! usage:cif/cthen/cloop...",e):void(this.__type!=e&&(this.__type=e,this.text=this._typetbl[e][0],0==this._typetbl[this.__type][8]?(this.width=36,this.height=60):(this.height=34,this.width=this.getTxtWidth()+2*this._trx)))}})}__extends(t,e);var n=t.prototype;return n.breset=function(){this.indexID=[],this.__selected=!1,this.__type=null},n.__customDraw=function(){var e=[[["moveTo",this._side,0],["lineTo",this.width-this._side,0],["lineTo",this.width,this._side],["lineTo",this.width,this.height-this._side],["lineTo",this.width-this._side,this.height],["lineTo",this._side,this.height],["lineTo",0,this.height-this._side],["lineTo",0,this._side],["closePath"]],[["moveTo",this._trx,0],["lineTo",this.width-this._trx,0],["lineTo",this.width,this.height],["lineTo",0,this.height],["closePath"]]],t=6;null==this.__type&&(console.log("frame type error!",this.text),this.__type="localVar");var n=this._typetbl[this.__type][8];this.__selected?(this.graphics.drawPath(0,0,e[n],{fillStyle:this._typetbl[this.__type][2]},{strokeStyle:this._typetbl[this.__type][1],lineWidth:this._typetbl[this.__type][6]}),0==n?this.graphics.drawRect(this.width+2,0,this._fwidth,this._fheight,this._typetbl[this.__type][7],this._typetbl[this.__type][5],this._typetbl[this.__type][6]):this.graphics.drawRect(0,this.height+1,this._fwidth,this._fheight,this._typetbl[this.__type][7],this._typetbl[this.__type][5],this._typetbl[this.__type][6])):(this.graphics.drawPath(0,0,e[n],{fillStyle:this._typetbl[this.__type][2]},{strokeStyle:this._typetbl[this.__type][1],lineWidth:this._typetbl[this.__type][4]}),0==n?this.graphics.drawRect(this.width+2,0,this._fwidth,this._fheight,this._typetbl[this.__type][7],this._typetbl[this.__type][3],this._typetbl[this.__type][4]):this.graphics.drawRect(0,this.height+1,this._fwidth,this._fheight,this._typetbl[this.__type][7],this._typetbl[this.__type][3],this._typetbl[this.__type][4])),"cif"!=this.__type&&"cthen"!=this.__type||(this.graphics.drawLine(this.width+t+2,t,this.width+t+2,this._fheight-2*t+2,"#74b1d4",2),this.graphics.drawLine(this.width+this._fwidth-t+2,t,this.width+this._fwidth-t+2,this._fheight-2*t+2,"#74b1d4",2))},n.setFrameSize=function(e,t){this._fwidth=e,this._fheight=t,this.isChanged=!0},n.onMouseHover=function(e){e.target==this&&$("#layaCanvas").css("cursor","pointer")},n.onMouseLeave=function(e){e.target==this&&$("#layaCanvas").css("cursor","default")},n.getTxtWidth=function(){return Laya.Browser.context.font=""+this.fontSize+"px "+this.font,Laya.Browser.context.measureText(this.text).width},n._typetbl={cif:["如\n果\n ","rgb(96,147,167)","rgba(0,0,0,0)","rgb(59,103,141)",1,"rgb(92,132,167)",2,"rgba(255,255,255,0.02)",0],cthen:["那\n么\n ","rgb(96,147,167)","rgba(0,0,0,0)","rgb(59,103,141)",1,"rgb(92,132,167)",2,"rgba(255,255,255,0.02)",0],forin:["循\n环\n ","rgb(96,147,167)","rgba(0,0,0,0)","rgb(59,103,141)",1,"rgb(92,132,167)",2,"rgba(255,255,255,0.02)",0],whiledo:["循\n环\n ","rgb(96,147,167)","rgba(0,0,0,0)","rgb(59,103,141)",1,"rgb(92,132,167)",2,"rgba(255,255,255,0.02)",0],parameter:["参数定义","rgb(100,116,135)","rgba(100,116,135,0.2)","rgb(100,116,135)",1,"rgb(100,116,135)",2,"rgba(0,0,0,0)",1],localVar:["局部变量","rgb(100,116,135)","rgba(100,116,135,0.2)","rgb(100,116,135)",1,"rgb(100,116,135)",2,"rgba(0,0,0,0)",1],globalVar:["全局变量","rgb(100,116,135)","rgba(100,116,135,0.2)","rgb(100,116,135)",1,"rgb(100,116,135)",2,"rgba(0,0,0,0)",1],funcFrame:["函数体","rgb(100,116,135)","rgba(100,116,135,0.2)","rgb(100,116,135)",1,"rgb(100,116,135)",2,"rgba(0,0,0,0)",1]},t}(Laya.Text),ButtonBlock=function(e){function t(){e.call(this),this.__pollClass="ButtonBlock",this.on("mouseover",this,this.onMouseHover),this.on("mouseout",this,this.onMouseLeave),this.on("mousedown",this,this.onMouseDown),this.on("mouseup",this,this.onMouseUp)}__extends(t,e);var n=t.prototype;return n.init=function(e){this.loadImage("psv/add.png"),this.type=e,this.indexID=null},n.onMouseHover=function(){$("#layaCanvas").css("cursor","pointer")},n.onMouseLeave=function(){$("#layaCanvas").css("cursor","default")},n.onMouseDown=function(){this.y=this.y+3,this.x=this.x+3},n.breset=function(){},n.onMouseUp=function(){this.y=this.y-3,this.x=this.x-3},t}(Laya.Sprite),LabelCtrl=function(e){function t(){e.call(this),this.__pollClass="LabelCtrl",this._imgN=this._imgS=null,this._labelItems=[],this._currLabel=0,this._lwidth=this._lheight=0,this._padding=14,this.on("click",this,this._label_click),Object.defineProperty(this,"currLabel",{get:function(){return this._currLabel},set:function(e){this._currLabel!=parseInt(e)&&parseInt(e)<this._labelItems.length&&(this._currLabel=parseInt(e),this._layout_label())}})}__extends(t,e);var n=t.prototype;return n.addLabelItem=function(e){var t=new Laya.Text;t.__customDraw=function(){null!=this.parent._imgN&&null!=this.parent._imgS&&(this.__selected?texture=Laya.loader.getRes(this.parent._imgS):texture=Laya.loader.getRes(this.parent._imgN),this.graphics.drawTexture(texture,0,0,this.parent._lwidth,this.parent._lheight))},Object.defineProperty(t,"selected",{get:function(){return this.__selected},set:function(e){this.__selected!=Boolean(e)&&(this.__selected=Boolean(e),this.isChanged=!0)}}),t.text=e,t.__selected=!1,t.align="center",t.valign="middle",t.fontSize=14,t.font="微软雅黑",t.padding=[5,0,12,0],t.on("mouseover",this,this.onMouseHover),t.on("mouseout",this,this.onMouseLeave),this.addChild(t),this._labelItems[this._labelItems.length]=t,this._layout_label()},n.addLabelItems=function(e){for(var t in e)this.addLabelItem(e[t])},n.setLabelImg=function(e,t,n,i){this._imgN=e,this._imgS=t,this._lwidth=n,this._lheight=i,this._layout_label()},n._layout_label=function(){for(var e=0;e<this._labelItems.length;e++)this._labelItems[e].width=this._lwidth,this._labelItems[e].height=this._lheight,this._labelItems[e].pos((this._padding+this._lwidth)*e,0),this._currLabel==e?(this._labelItems[e].selected=!0,this._labelItems[e].color="#ffffff"):(this._labelItems[e].selected=!1,this._labelItems[e].color="#9eb7c3")},n._label_click=function(e){for(var t=e.target,n=0;n<this._labelItems.length&&t!==this._labelItems[n];n++);this._currLabel!=n&&(this.currLabel=n,this.event("labelclick"))},n.onMouseHover=function(){$("#layaCanvas").css("cursor","pointer")},n.onMouseLeave=function(){$("#layaCanvas").css("cursor","default")},t}(Laya.Sprite),ConnectBlock=function(e){function t(){e.call(this),this.__pollClass="ConnectBlock",this._conn_array=[],this.width=this.height=10,this._radius=4,this._line_width=21}__extends(t,e);var n=t.prototype;return n.addPoint=function(e,t){this._conn_array.push(e,t)},n.breset=function(){this._conn_array=[]},n.drawLines=function(){var e="#6093a7";this.graphics.drawCircle(this._conn_array[0]-1-this._radius,this._conn_array[1],this._radius,null,e);var t=this._conn_array[0]-this._line_width-1-2*this._radius;this.graphics.drawLine(this._conn_array[0]-1-2*this._radius,this._conn_array[1],t,this._conn_array[1],e),this.graphics.drawLine(t,this._conn_array[1],t,this._conn_array[this._conn_array.length-1],e);for(var n=2;n<this._conn_array.length-1;n+=2)this.graphics.drawLine(this._conn_array[n],this._conn_array[n+1],t,this._conn_array[n+1],e)},t}(Laya.Sprite),dConst={opArith:0,opComp:1,opAssign:3,ctrlState:51,led:100,uSound:104,servo:105,motorCtrl:106,buzzer:107,kbd:108,argNumber:200,argBool:202,argArray:203,libGetNum:300,libGetBool:302,libGetArray:303,libSet:304,objGetNum:351,objSet:355,arraySet:356,arrayGetNum:357,varNumber:500,varArray:502,varTuple:503,nonExist:550,beginningOL:600,inputNum:601,enumBool:603,rBracket:604,lBracket:605,newBlock:606,forin1st:607,forin2nd:608},menuDefine=[{name:"全局变量",getItemFunc:getGlobalVarItem},{name:"局部变量",getItemFunc:getLocalVarItem},{name:"参数定义",getItemFunc:getParamItem},{name:"设备对象",subItem:[{index:["periObj","led1"]},{index:["periObj","led2"]},{index:["periObj","led3"]},{index:["periObj","led4"]},{index:["periObj","uSound"]},{index:["periObj","servo"]},{index:["periObj","buzzer"]},{index:["periObj","motorCtrl"]}]},{name:"对象方法",subItem:[{index:["objMethod","on"],filter:[dConst.led]},{index:["objMethod","off"],filter:[dConst.led]},{index:["objMethod","toggle"],filter:[dConst.led]},{index:["objMethod","getDistance"],filter:[dConst.uSound]},{index:["objMethod","sAngle"],filter:[dConst.servo]},{index:["objMethod","goForward"],filter:[dConst.motorCtrl]},{index:["objMethod","goBackward"],filter:[dConst.motorCtrl]},{index:["objMethod","motorStop"],filter:[dConst.motorCtrl]},{index:["objMethod","turnLeft"],filter:[dConst.motorCtrl]},{index:["objMethod","turnRight"],filter:[dConst.motorCtrl]},{index:["objMethod","buzz"],filter:[dConst.buzzer]}]},{name:"调用子函数",getItemFunc:getSubfuncItem},{name:"函数库",subItem:[{index:["libFunc","delay"]},{index:["libFunc","random"]},{index:["libFunc","randomInt"]},{index:["libFunc","len"]},{index:["libFunc","range"]},{index:["libFunc","range3"]},{index:["libFunc","abs"]},{index:["libFunc","sqrt"]},{index:["libFunc","pow"]},{index:["libFunc","sin"]},{index:["libFunc","cos"]},{index:["libFunc","tan"]},{index:["libFunc","asin"]},{index:["libFunc","acos"]},{index:["libFunc","atan"]},{index:["arrayMethod","append"]},{index:["arrayMethod","insert"]},{index:["arrayMethod","pop"]}]},{name:"操作符",subItem:[{index:["opreator","plus"]},{index:["opreator","sub"]},{index:["opreator","mul"]},{index:["opreator","div"]},{index:["opreator","equ"]},{index:["opreator","notEqu"]},{index:["opreator","lessThan"]},{index:["opreator","lessEqu"]},{index:["opreator","greatThan"]},{index:["opreator","greatEqu"]},{index:["opreator","assignment"]},{index:["opreator","plusAssi"]},{index:["opreator","subAssi"]},{index:["opreator","mulAssi"]},{index:["opreator","divAssi"]}]}],prefixFilter=[[{prefix:dConst.beginningOL,filter:[dConst.varNumber,dConst.varArray,dConst.inputNum,dConst.uSound,dConst.libGetNum]},{prefix:dConst.uSound,filter:[dConst.objGetNum],nfilter:["getDistance"]},{prefix:dConst.opArith,filter:[dConst.inputNum,dConst.varNumber,dConst.libGetNum,dConst.uSound]},{prefix:dConst.opComp,filter:[dConst.inputNum,dConst.varNumber,dConst.libGetNum,dConst.uSound]},{prefix:dConst.objGetNum,filter:[dConst.opComp,dConst.opArith]},{prefix:dConst.libGetNum,filter:[dConst.opComp,dConst.opArith]},{prefix:dConst.varNumber,filter:[dConst.opComp,dConst.opArith]},{prefix:dConst.inputNum,filter:[dConst.opComp,dConst.opArith]},{prefix:dConst.argNumber,filter:[dConst.inputNum,dConst.varNumber,dConst.libGetNum,dConst.uSound]},{prefix:dConst.argArray,filter:[dConst.varArray,dConst.varTuple,dConst.libGetArray]},{prefix:dConst.rBracket,filter:[dConst.opComp,dConst.opArith]},{prefix:dConst.forin1st,filter:[dConst.varNumber]},{prefix:dConst.forin2nd,filter:[dConst.varArray,dConst.libGetArray]}],[{prefix:dConst.beginningOL,filter:[dConst.varNumber,dConst.varArray,dConst.varTuple,dConst.inputNum,dConst.uSound,dConst.led,dConst.servo,dConst.motorCtrl,dConst.buzzer,dConst.libGetNum,dConst.libSet]},{prefix:dConst.led,filter:[dConst.objGetNum,dConst.objSet],nfilter:["on","off","toggle"]},{prefix:dConst.uSound,filter:[dConst.objGetNum,dConst.objSet],nfilter:["getDistance"]},{prefix:dConst.servo,filter:[dConst.objGetNum,dConst.objSet],nfilter:["sAngle"]},{prefix:dConst.motorCtrl,filter:[dConst.objGetNum,dConst.objSet],nfilter:["goForward","goBackward","turnLeft","turnRight","motorStop"]},{prefix:dConst.buzzer,filter:[dConst.objGetNum,dConst.objSet],nfilter:["buzz"]},{prefix:dConst.opArith,filter:[dConst.inputNum,dConst.varNumber,dConst.libGetNum,dConst.uSound]},{prefix:dConst.opAssign,filter:[dConst.inputNum,dConst.varNumber,dConst.libGetNum,dConst.uSound]},{prefix:dConst.objGetNum,filter:[dConst.opArith]},{prefix:dConst.libGetNum,filter:[dConst.opArith]},{prefix:dConst.varNumber,filter:[dConst.opAssign,dConst.opArith]},{prefix:dConst.varArray,filter:[dConst.arraySet]},{prefix:dConst.inputNum,filter:[dConst.opArith]},{prefix:dConst.argNumber,filter:[dConst.inputNum,dConst.varNumber,dConst.libGetNum,dConst.uSound]},{prefix:dConst.argArray,filter:[dConst.varArray,dConst.varTuple,dConst.libGetArray]},{prefix:dConst.rBracket,filter:[dConst.opArith]}]],type2prop={bool:dConst.enumBool,number:dConst.inputNum,unSelect:{newBlock:["请选择",dConst.newBlock]},globalVar:{number:["数字",dConst.varNumber],array:["列表",dConst.varArray],tuple:["元组",dConst.varTuple],arrayI:["",dConst.varNumber],tupleI:["",dConst.led],__errorID:["",dConst.nonExist]},localVar:{number:["数字",dConst.varNumber],array:["列表",dConst.varArray],arrayI:["",dConst.varNumber],__errorID:["",dConst.nonExist]},parameter:{number:["数字",dConst.varNumber],array:["列表",dConst.varArray],arrayI:["",dConst.varNumber],__errorID:["",dConst.nonExist]},ctrlState:{returns:["返回",dConst.ctrlState,"",dConst.argNumber],breaks:["中止循环",dConst.ctrlState],continues:["跳过以下语句",dConst.ctrlState]},periObj:{led1:["1号LED",dConst.led],led2:["2号LED",dConst.led],led3:["3号LED",dConst.led],led4:["4号LED",dConst.led],uSound:["超声波探测器",dConst.uSound],servo:["舵机云台",dConst.servo],motorCtrl:["马达总成",dConst.motorCtrl],buzzer:["蜂鸣器",dConst.buzzer],usrKey:["usr按键",dConst.kbd]},opreator:{plus:["加",dConst.opArith],sub:["减",dConst.opArith],mul:["乘",dConst.opArith],div:["除",dConst.opArith],divis:["整除",dConst.opArith],equ:["等于",dConst.opComp],notEqu:["不等于",dConst.opComp],lessThan:["小于",dConst.opComp],lessEqu:["小于等于",dConst.opComp],greatThan:["大于",dConst.opComp],greatEqu:["大于等于",dConst.opComp],assignment:["赋值为",dConst.opAssign],plusAssi:["增加",dConst.opAssign],subAssi:["减少",dConst.opAssign],mulAssi:["乘等于",dConst.opAssign],divAssi:["除等于",dConst.opAssign]},logical:{and:[" 且 ",dConst.beginningOL],or:[" 或 ",dConst.beginningOL]},brackets:{sleft:["（",dConst.lBracket],sright:["）",dConst.rBracket]},libFunc:{delay:["延时等待（毫秒）",dConst.libSet,"",dConst.argNumber],random:["取0~1间随机数",dConst.libGetNum,"",dConst.argNumber],randomInt:["取随机整数",dConst.libGetNum,"起始范围 :",dConst.argNumber,"结束范围 :",dConst.argNumber],len:["取数组长度",dConst.libGetNum,"",dConst.argArray],range:["生成范围数组",dConst.libGetArray,"",dConst.argNumber],range3:["生成范围数组（3参数）",dConst.libGetArray,"范围起点 :",dConst.argNumber,"范围终点 :",dConst.argNumber,"步长 :",dConst.argNumber],abs:["取绝对值",dConst.libGetNum,"",dConst.argNumber],sqrt:["取平方根",dConst.libGetNum,"",dConst.argNumber],pow:["取x的y次方",dConst.libGetNum,"x :",dConst.argNumber,"y :",dConst.argNumber],sin:["取正弦值",dConst.libGetNum,"",dConst.argNumber],asin:["取反正弦弦值",dConst.libGetNum,"",dConst.argNumber],cos:["取余弦值",dConst.libGetNum,"",dConst.argNumber],acos:["取反余弦值",dConst.libGetNum,"",dConst.argNumber],tan:["取正切值",dConst.libGetNum,"",dConst.argNumber],atan:["取反正切值",dConst.libGetNum,"",dConst.argNumber]},arrayMethod:{append:["在末尾添加元素",dConst.arraySet,"",dConst.argNumber],insert:["插入元素",dConst.arraySet,"数组下标 :",dConst.argNumber,"插入内容 :",dConst.argNumber],pop:["删除元素",dConst.arraySet,"",dConst.argNumber]},objMethod:{on:["点亮",dConst.objSet],off:["熄灭",dConst.objSet],toggle:["翻转",dConst.objSet],blink:["闪烁",dConst.objSet,"次数 :",dConst.argNumber,"频率（每秒几次）:",dConst.argNumber],getDistance:["测距",dConst.objGetNum],sAngle:["转动角度",dConst.objSet,"角度 :",dConst.argNumber,"用时（毫秒）:",dConst.argNumber],goForward:["保持前进",dConst.objSet,"保持时间（毫秒）:",dConst.argNumber],goBackward:["保持后退",dConst.objSet,"保持时间（毫秒）:",dConst.argNumber],motorStop:["停止",dConst.objSet],turnLeft:["左转",dConst.objSet,"保持时间（毫秒）:",dConst.argNumber],turnRight:["右转",dConst.objSet,"保持时间（毫秒）:",dConst.argNumber],buzz:["蜂鸣",dConst.objSet,"频率 :",dConst.argNumber,"时长（毫秒）:",dConst.argNumber],keyPress:["按下",dConst.objGetBool]}},varProp={number:dConst.varNumber,array:dConst.varArray,tuple:dConst.varTuple},jsonObj={project:{hardware:"PYV100"},simulation:{width:800,height:600},globalVar:[{name:"LED元组",type:"tuple",value:[{type:"periObj",name:"led1"},{type:"periObj",name:"led2"},{type:"periObj",name:"led3"},{type:"periObj",name:"led4"}],id:0},{name:"前方障碍距离",type:"number",value:"0",id:1},{name:"左侧障碍距离",type:"number",value:"0",id:2},{name:"右侧障碍距离",type:"number",value:"0",id:3},{name:"临时变量i",type:"number",value:"0",id:4},{name:"转弯保持时间",type:"number",value:"300",id:5}],main:[{block:"line",subs:[{type:"periObj",name:"buzzer"},{type:"objMethod",name:"buzz",args:[{type:"number",value:"440"},{type:"number",value:"500"}]}]},{block:"line",subs:[{type:"libFunc",name:"delay",args:[{type:"number",value:"1000"}]}]},{block:"line",subs:[{type:"periObj",name:"servo"},{type:"objMethod",name:"sAngle",args:[{type:"number",value:"0"},{type:"number",value:"100"}]}]},{block:"forin",subs:[{block:"line",subs:[{type:"globalVar",id:4},{type:"libFunc",name:"range",args:[{type:"libFunc",name:"len",args:[{type:"globalVar",id:0}]}]}]},[{block:"line",subs:[{type:"globalVar",id:0,arrayIndex:[{type:"globalVar",id:4}]},{type:"objMethod",name:"off"}]}]]},{block:"line",subs:[{type:"subFunc",id:1,args:[{type:"number",value:"4"}]}]},{block:"line",subs:[{type:"subFunc",id:0}]},{block:"whiledo",subs:[{block:"line",subs:[{type:"number",value:"1"}]},[{block:"line",subs:[{type:"globalVar",id:1},{type:"opreator",name:"assignment"},{type:"periObj",name:"uSound"},{type:"objMethod",name:"getDistance"}]},{block:"ifelse",subs:[{block:"line",subs:[{type:"globalVar",id:1},{type:"opreator",name:"greatThan"},{type:"number",value:"50"}]},[{block:"line",subs:[{type:"periObj",name:"motorCtrl"},{type:"objMethod",name:"goForward",args:[{type:"number",value:"200"}]}]}],[{block:"line",subs:[{type:"periObj",name:"motorCtrl"},{type:"objMethod",name:"motorStop"}]},{block:"line",subs:[{type:"libFunc",name:"delay",args:[{type:"number",value:"400"}]}]},{block:"line",subs:[{type:"periObj",name:"servo"},{type:"objMethod",name:"sAngle",args:[{type:"number",value:"90"},{type:"number",value:"300"}]}]},{block:"line",subs:[{type:"libFunc",name:"delay",args:[{type:"number",value:"500"}]}]},{block:"line",subs:[{type:"globalVar",id:2},{type:"opreator",name:"assignment"},{type:"periObj",name:"uSound"},{type:"objMethod",name:"getDistance"}]},{block:"line",subs:[{type:"periObj",name:"servo"},{type:"objMethod",name:"sAngle",args:[{type:"number",value:"-90"},{type:"number",value:"300"}]}]},{block:"line",subs:[{type:"libFunc",name:"delay",args:[{type:"number",value:"500"}]}]},{block:"line",subs:[{type:"globalVar",id:3},{type:"opreator",name:"assignment"},{type:"periObj",name:"uSound"},{type:"objMethod",name:"getDistance"}]},{block:"line",subs:[{type:"periObj",name:"servo"},{type:"objMethod",name:"sAngle",args:[{type:"number",value:"0"},{type:"number",value:"300"}]}]},{block:"line",subs:[{type:"libFunc",name:"delay",args:[{type:"number",value:"500"}]}]},{block:"ifelse",subs:[{block:"line",subs:[{type:"globalVar",id:2},{type:"opreator",name:"greatThan"},{type:"number",value:"50"},{type:"logical",name:"and"},{type:"globalVar",id:3},{type:"opreator",name:"greatThan"},{type:"number",value:"50"}]},[{block:"ifelse",subs:[{block:"line",subs:[{type:"globalVar",id:2},{type:"opreator",name:"greatThan"},{type:"globalVar",id:3}]},[{block:"line",subs:[{type:"subFunc",id:2,args:[{type:"number",value:"1"}]}]},{block:"line",subs:[{type:"periObj",name:"motorCtrl"},{type:"objMethod",name:"turnLeft",args:[{type:"globalVar",id:5}]}]}],[{block:"line",subs:[{type:"subFunc",id:2,args:[{type:"number",value:"2"}]}]},{block:"line",subs:[{type:"periObj",name:"motorCtrl"},{type:"objMethod",name:"turnRight",args:[{type:"globalVar",id:5}]}]}]]}],{block:"line",subs:[{type:"globalVar",id:2},{type:"opreator",name:"greatThan"},{type:"number",value:"50"},{type:"logical",name:"and"},{type:"globalVar",id:3},{type:"opreator",name:"lessThan"},{type:"number",value:"50"}]},[{block:"line",subs:[{type:"subFunc",id:2,args:[{type:"number",value:"3"}]}]},{block:"line",subs:[{type:"periObj",name:"motorCtrl"},{type:"objMethod",name:"turnLeft",args:[{type:"globalVar",id:5}]}]}],{block:"line",subs:[{type:"globalVar",id:2},{type:"opreator",name:"lessThan"},{type:"number",value:"50"},{type:"logical",name:"and"},{type:"globalVar",id:3},{type:"opreator",name:"greatThan"},{type:"number",value:"50"}]},[{block:"line",subs:[{type:"subFunc",id:2,args:[{type:"number",value:"4"}]}]},{block:"line",subs:[{type:"periObj",name:"motorCtrl"},{type:"objMethod",name:"turnRight",args:[{type:"globalVar",id:5}]}]}],[{block:"line",subs:[{type:"periObj",name:"motorCtrl"},{type:"objMethod",name:"goBackward",args:[{type:"number",value:"600"}]}]},{block:"line",subs:[{type:"periObj",name:"motorCtrl"},{type:"objMethod",name:"motorStop"}]}]]}]]}]]}],subFunc:[{name:"播放《小星星》音乐",type:"subfunc",id:0,parameter:[],localVar:[{type:"number",name:"循环变量",id:0,value:"0"},{type:"array",name:"音阶频率表",value:[{type:"number",value:"440"},{type:"number",value:"494"},{type:"number",value:"554"},{type:"number",value:"587"},{type:"number",value:"659"},{type:"number",value:"740"},{type:"number",value:"831"}],id:1},{type:"array",name:"小星星第一句",value:[{type:"number",value:"1"},{type:"number",value:"500"},{type:"number",value:"1"},{type:"number",value:"500"},{type:"number",value:"5"},{type:"number",value:"500"},{type:"number",value:"5"},{type:"number",value:"500"},{type:"number",value:"6"},{type:"number",value:"500"},{type:"number",value:"6"},{type:"number",value:"500"},{type:"number",value:"5"},{type:"number",value:"1000"},{type:"number",value:"4"},{type:"number",value:"500"},{type:"number",value:"4"},{type:"number",value:"500"},{type:"number",value:"3"},{type:"number",value:"500"},{type:"number",value:"3"},{type:"number",value:"500"},{type:"number",value:"2"},{type:"number",value:"500"},{type:"number",value:"2"},{type:"number",value:"500"},{type:"number",value:"1"},{type:"number",value:"1000"}],id:2}],funcblock:[{block:"whiledo",subs:[{block:"line",subs:[{type:"localVar",id:0},{type:"opreator",name:"lessThan"},{type:"libFunc",name:"len",args:[{type:"localVar",id:2}]}]},[{block:"line",subs:[{type:"periObj",name:"buzzer"},{type:"objMethod",name:"buzz",args:[{type:"localVar",id:1,arrayIndex:[{type:"localVar",id:2,arrayIndex:[{type:"localVar",id:0}]},{type:"opreator",name:"sub"},{type:"number",value:"1"}]},{type:"localVar",id:2,arrayIndex:[{type:"localVar",id:0},{type:"opreator",name:"plus"},{type:"number",value:"1"}]}]}]},{block:"line",subs:[{type:"localVar",id:0},{type:"opreator",name:"plusAssi"},{type:"number",value:"2"}]}]]}]},{name:"循环闪烁LED指定次数",type:"subfunc",id:1,parameter:[{type:"number",name:"次数",id:0}],localVar:[{type:"number",value:"0",name:"循环变量i",id:0},{type:"number",value:"0",name:"循环变量j",id:1}],funcblock:[{block:"forin",subs:[{block:"line",subs:[{type:"localVar",id:0},{type:"libFunc",name:"range",args:[{type:"number",value:"4"}]}]},[{block:"forin",subs:[{block:"line",subs:[{type:"localVar",id:1},{type:"libFunc",name:"range",args:[{type:"libFunc",name:"len",args:[{type:"globalVar",id:0}]}]}]},[{block:"line",subs:[{type:"globalVar",id:0,arrayIndex:[{type:"localVar",id:1}]},{type:"objMethod",name:"toggle"}]},{block:"line",subs:[{type:"libFunc",name:"delay",args:[{type:"number",value:"125"}]}]},{block:"line",subs:[{type:"globalVar",id:0,arrayIndex:[{type:"localVar",id:1}]},{type:"objMethod",name:"toggle"}]},{block:"line",subs:[{type:"libFunc",name:"delay",args:[{type:"number",value:"125"}]}]}]]}]]}]},{name:"转弯LED指示",type:"subfunc",id:2,parameter:[{type:"number",name:"LED序号",id:0}],localVar:[],funcblock:[{block:"line",subs:[{type:"globalVar",id:0,arrayIndex:[{type:"parameter",id:0}]},{type:"objMethod",name:"on"
}]},{block:"line",subs:[{type:"libFunc",name:"delay",args:[{type:"number",value:"500"}]}]},{block:"line",subs:[{type:"globalVar",id:0,arrayIndex:[{type:"parameter",id:0}]},{type:"objMethod",name:"off"}]}]}]},padding={topStart:200,blockLR:20,blockInter:10,lineLR:20,line2Frame:12,lineInter:6,frame2Frame:12,ifelseIndent:50,conBlockIndent:88,loopIndent:20,conFramGap:38,frameR:20,lineIfIndent:60,lineLoopIndent:58,lineHeight:46,blockHeight:32,blockRadius:10,mIfelseIndent:88,mLoopIndent:58,varTypeL:27,varFrameHead:35,addButtonWidth:109,funcNameL:30,sMenuWidth:410,sMenuHeight:440,ifelseAdjust:208,ifthenAdjust:138,ifconAdjust:84,loopAdjust:134,pop1Width:102,pop1Height:118},eMenu={enew:0,ecopy:1,epaste:2,edelete:3,einsert:4,egroup:5},iMenu={iblock:0,iline:1,iifelse:2,iforin:3,iwhiledo:4,ibreak:5,icontinue:6,ireturn:7},main_box=new Laya.Sprite,mainBlock_box=new Laya.Sprite,subBlock_box=new Laya.Sprite,box_labelCtrl=new LabelCtrl,menu_box=new Laya.Sprite,fileButton,skinButton,selectedBlock=null,max_lenX,max_lenY,stage_skin=!0,input_block=new Laya.Input,file_menu=new PopMenu,insert_menu=new PopMenu,group_menu=new PopMenu,pop_var_type=new PopMenu,pop_logical=new PopMenu,pop_ifstate=new PopMenu,open_file,fileName="PSV示例工程-智能避障.json",ani_block,ani_box,auto_insert=!1;Laya.loader.load("res/img/psv.json",Laya.Handler.create(this,pre_process),null,Laya.Loader.ATLAS);var scrollUnitY=32;Laya.stage.on("mousewheel",Laya.stage,stage_on_wheel),Laya.stage.on("keydown",Laya.stage,stage_on_keydown);var max_width;$(".modal-body").on("click",".input_box>a",function(){var e=$(".input_box>input").val();""==e&&(e="0");var t={type:"number",value:e};modify_json_block(t)}),$(".modal-content").find(".close").click(function(){if($(".modal").css("display","none"),auto_insert){var e=selectedBlock.indexID.slice(0,selectedBlock.indexID.length-1),t=get_entry_array(e),n=selectedBlock.indexID[selectedBlock.indexID.length-1];t.splice(n,1),clear_selected_block(),disable_all_menu(),auto_insert=!1,refresh_curr_page()}else auto_insert=!1,clear_selected_block(),disable_all_menu()});